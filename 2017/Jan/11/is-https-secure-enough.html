<!DOCTYPE html><title>Is HTTPS secure enough?!?! - manhhomienbienthuy's space</title> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=apple-touch-icon href=/theme/images/icon-touch.png> <link rel=icon sizes=192x192 href=/theme/images/icon-touch.png> <link rel="shortcut icon" href=/theme/images/favicon.ico> <link rel=author href=/humans.txt> <meta name=msapplication-TileImage content=/theme/images/icon-tile.png> <meta name=twitter:dnt content=on> <meta name=Author content=manhhomienbienthuy> <meta name=rating content=general> <meta name=twitter:card content=product> <meta name=twitter:site content=@_naa_4f> <meta name=twitter:creator content=@_naa_4f> <link href=/feeds/all.atom.xml type=application/atom+xml rel=alternate title="manhhomienbienthuy's space Full Atom Feed"> <meta name=description content="HTTPS hay còn được gọi là HTTP Secure, hoặc HTTP over SSL, HTTP over TLS là một giao thức được coi là bảo mật hơn của giao thức truy cập Web HTTP thông thường. Bản thân nó đã có nghĩa " bảo mật&quot; nhưng liệu thực sự nó có đủ bảo …&quot;> <meta name=keywords content="Security, Cryptography, HTTPS, SSL, TLS, crack, CTF, blog, naa, manhhomienbienthuy, pelican, static site generator"> <meta name=twitter:title content="Is HTTPS secure enough?!?! - manhhomienbienthuy's space"> <meta name=twitter:description content="HTTPS hay còn được gọi là HTTP Secure, hoặc HTTP over SSL, HTTP over TLS là một giao thức được coi là bảo mật hơn của giao thức truy cập Web HTTP thông thường. Bản thân nó đã có nghĩa " bảo mật&quot; nhưng liệu thực sự nó có đủ bảo …&quot;> <meta name=twitter:image content=/https://i.imgur.com/ab17F91.png> <link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css> <link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css> <link rel=stylesheet href=/theme/css/vpyeu.min.css?5d2c7d5e> <header> <div class=navbar> <div class=wrapper> <div class=nav-menu> <div class=menu-toggle> <i class="fa fa-reorder"></i> </div> <ul class=menus> <li><a href=/ >Home</a> <li><a href=/category/general.html class=current> General <li><a href=/category/life.html> Life <li><a href=/category/programming.html> Programming <li><a href=/category/travel.html> Travel </ul> </div><div class="right links"> <ul> <li> <a href=https://twitter.com/_naa_4f target=_blank> <i class="fa fa-twitter"></i> </a> <li> <a href=https://instagram.com/manhhomienbienthuy/ target=_blank> <i class="fa fa-instagram"></i> </a> <li> <a href=https://www.facebook.com/manhhomienbienthuy target=_blank> <i class="fa fa-facebook"></i> </a> <li> <a href=https://github.com/manhhomienbienthuy target=_blank> <i class="fa fa-github"></i> </a> <li> <a href=/feeds/all.atom.xml target=_blank> <i class="fa fa-rss"></i> </a> </ul> </div> </div> </div><noscript> <div class="warning head-warn"> <div class=wrapper> <p><strong>Notice:</strong> While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </div> </div> </noscript><div class=banner> <div class=wrapper> <a href=/ > <img alt="manhhomienbienthuy's space" src=/theme/images/logo.png> </a> </div> </div></header> <main> <div class=wrapper> <div class=main-wrapper> <div class=entry> <div class=entry-detail> <div class=post> <h1 class=title> Is HTTPS secure enough?!?! </h1> <div class=meta> Posted in <a href=/category/general.html>General</a> on January 11, 2017 by <a href=/pages/about-me.html>manhhomienbienthuy</a> <span class=right> <i class="fa fa-comments"></i> <a href=#disqus_thread data-disqus-identifier=/2017/Jan/11/is-https-secure-enough.html> Comments </a> </span> </div> <div class=post-body> <img src=https://i.imgur.com/ab17F91.png alt="Is HTTPS secure enough?!?!"> <p>HTTPS hay còn được gọi là HTTP Secure, hoặc HTTP over SSL, HTTP over TLS là một giao thức được coi là bảo mật hơn của giao thức truy cập Web HTTP thông thường. Bản thân nó đã có nghĩa "bảo mật" nhưng liệu thực sự nó có đủ bảo mật như chúng ta vẫn nghĩ hay không? Trong bài viết này, chúng ta sẽ tìm hiểu thêm về HTTPS và cách thức bảo mật của nó.</p> <h1 id=tai-sao-chung-ta-can-en-https>Tại sao chúng ta cần đến HTTPS<a class=headerlink href=#tai-sao-chung-ta-can-en-https title="Permanent link">&para;</a></h1> <p>Hiện nay Google đã thêm <a href=https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html>tiêu chí sử dụng HTTPS</a> để đánh giá các trang Web. Tuy nhiên, không phải lúc nào chúng ta cũng cần đến HTTPS. Chúng ta chỉ cần chúng khi bảo mật thông tin mà thôi.</p> <h2 id=tai-sao-phai-bao-mat-thong-tin>Tại sao phải bảo mật thông tin?<a class=headerlink href=#tai-sao-phai-bao-mat-thong-tin title="Permanent link">&para;</a></h2> <p>Trong thời chiến tranh, rất nhiều thông tin quân sự, tình báo chỉ có thể thông tin cho một số người, những người khác, nhất là kẻ địch không được biết. Tuy nhiên, vì nhiều lý do, việc truyền tải tin tức không thể trực tiếp từ người gửi đến thẳng người nhận, mà phải thông qua một số trung gian nhất định. Việc truyền tải như vậy khiến tin tức dễ dàng bị lọt ra ngoài. Ví dụ, các phương thức truyền tin bằng điện tín dễ dàng bị bắt trộm sóng và nghe lén.</p> <p>Vì vậy, người ta dùng nhiều phương thức khác nhau đễ mã hóa đoạn tin cần gửi, để đảm bảo rằng, ngoại trừ người cần nhận, những người khác dù nghe được cũng không hiểu gì. Nếu bạn đã từng xem phim <a href=http://www.imdb.com/title/tt0245562/ >Windtalkers</a> thì bạn có thể hiển được tầm quan trọng của mã hóa trong chiến tranh là như thế nào.</p> <p>Tương tự như vậy, trên Internet hiện nay có rất nhiều kiểu tấn công kiểu nghe lén như vậy. Một hình thức phổ biến được gọi là Eavesdrop, ngoài ra còn một kiểu tấn công mạnh hơn nữa gọi là Man in the Middle. Tuy nhiên, nội dung bài viết này sẽ không đi sâu vào chi tiết các kiểu tấn công đó, có thể tôi sẽ trở lại trong bài viết sắp tới. Những gì tôi muốn nói ở đây là những gì chúng ta làm trên Internet không bao giờ là riêng tư theo đúng nghĩa cả.</p> <blockquote> <p>Big Brother is watching you</p> </blockquote> <p>Mạng Internet là một nơi kết nối rất nhiều máy tính, một gói tin đi từ người gửi trước khi đến với người nhận sẽ phải đi qua rất nhiều máy trung gian khác nhau. Vì vậy, việc bị đọc trộm các gói tin này đã trở thành một phần tất yếu của lịch sử. Không ai có thể ngăn chặn được những kẻ táy máy tìm cách đọc trộm gói tin của chúng ta trên đường đi. Thậm chí, cơ chế hoạt động của Internet cho phép việc nghe lén này diễn ra hết sức dễ dàng. Nếu không tin, bạn có thể cài thử <a href=https://www.wireshark.org/ >Wireshark</a> và xem mạng mà bạn đang sử dụng có những hoạt động nhộn nhịp như thế nào.</p> <p>Những gì chúng ta làm trên Internet có nhiều thứ người khác biết cũng chẳng sao. Nhưng cũng có nhiều thứ chúng ta chẳng muốn ai biết cả. Và một nhu cầu hết sức chính đáng của con người là che giấu một số thứ có thể gọi là "bí mật" đó khỏi con mắt nhòm ngó của những người xung quanh. Vì việc xem trộm các gói tin diễn ra hết sức bình thường như vậy, nên chúng ta cần đến các phương thức mã hóa để đảm bảo rằng, gói tin mà chúng ta gửi đi chỉ có chúng ta và nơi nhận hiểu được. Tất cả những kẻ táy máy đọc trộm trên đường dù đọc được cũng không hiểu được gì.</p> <p>Đó là lý do chúng ta cần đến HTTPS trong các giao dịch Web, HTTPS sẽ giúp chúng ta mã hóa quá trình giao dịch của máy chủ Web và trình duyệt. Ngoài ra, HTTPS còn một số tác dụng khác nữa, như xác thực máy chủ (tránh bị phishing), v.v...</p> <h2 id=https-bao-mat-giao-dich-nhu-the-nao>HTTPS bảo mật giao dịch như thế nào?<a class=headerlink href=#https-bao-mat-giao-dich-nhu-the-nao title="Permanent link">&para;</a></h2> <p>Khi trình duyệt truy cập trang Web sử dụng HTTPS, trình duyệt và máy chủ sẽ thiết lập một kết nối SSL bằng cách sử dụng giao thức <a href=https://tools.ietf.org/html/rfc5246#page-37>SSL Handshake</a>. Quá trình thiết lập kết nối này hoàn toàn trong suốt với người dùng, thông thường người dùng không cần quan tâm đến nó.</p> <p>Để thiết lập kết nối SSL, có 3 khóa được sử dụng: public key, private key và session key. Public key và private lập thành một cặp: mọi thứ cần mã hóa được mã hóa bằng public key và giải mã bằng private key. Session key là khóa dùng trong phương thức mã hóa đối xứng, nó được dùng cho cả quá trình mã hóa và giải mã.</p> <blockquote> <p>Nếu bạn chưa hiểu hết về các phương thức mã hóa bằng public key và mã đối xứng, có lẽ bạn nên tìm hiểu về chúng trước khi chúng ta tiếp tục.</p> </blockquote> <p>Việc mã hóa bằng public key rất tốn kém nên nó chỉ được dùng vào thời điểm thiết lập kết nối, sau khi kết nối được thiết lập, mã hóa đối xứng sẽ được sử dụng (với khóa là session key). Toàn bộ quá trình diễn ra như sau:</p> <ol> <li>Trình duyệt kết nối với máy chủ sử dụng HTTPS.</li> <li>Máy chủ trả về một SSL certificate, trong đó có chứa public key dùng để mã hóa.</li> <li>Trình duyệt kiểm tra certificate (quá trình này chúng ta sẽ tìm hiểu ở phần sau). Nếu mọi thứ đều ổn hoặc người dùng cố xử lý tiếp thì trình duyệt sẽ sinh ngẫu nhiên session key và gửi cho server (dữ liệu được mã hóa bằng public key).</li> <li>Máy chủ sử dụng private key giải mã gói tin lấy session key, gửi phản hồi đã nhận key cho trình duyệt.</li> <li>Từ đây trở đi, máy chủ và trình duyệt gửi nhận các gói tin được mã hóa bằng session key.</li> </ol> <h2 id=ssl-certificate>SSL certificate<a class=headerlink href=#ssl-certificate title="Permanent link">&para;</a></h2> <p>SSL certificate là giấy chứng nhận được dùng khi thiết lập kết nối giữa trình duyệt và máy chủ. SSL certificate về mặt kỹ thuật là những tập tin kích thước tương đối nhỏ trong đó có lưu thông tin về public key cùng với các thông tin khác về tổ chức chủ sở hữu của trang Web.</p> <p>Một số thông tin được lưu trong SSL certificate:</p> <ul> <li>Domain, tên server, hostname</li> <li>Tên công ty, tổ chức, địa chỉ liên hệ</li> <li>Thời hạn sử dụng</li> <li>Public key</li> </ul> <p>Tuy nhiên, giấy chứng nhận này hoàn toàn có thể bị làm giả. Giống như chúng ta viết sơ yếu lý lịch vậy, làm sao để biết chúng ta đã viết những thông tin chính xác? Chúng ta cần phải có xác nhận của chính quyền địa phương. SSL certificate cũng tương tự như vậy, để đảm bảo chứng nhận này không phải là giả, chúng ta cần đến Certificate Authority.</p> <p><a href=https://en.wikipedia.org/wiki/Certificate_authority>Certificate Authority (CA)</a> có thể xác nhận rằng certificate là thật, họ sẽ sử dụng chữ ký điện tử với private key của riêng họ. CA sẽ đóng vai trò như những công chứng viên đã được cấp giấy phép hành nghề, chữ ký của họ được tin tưởng và certificate được họ chứng nhận có thể coi là hợp lệ.</p> <p>Thường thì CA bán các giấy chứng nhận này và họ sẽ xác nhận cho giấy tờ mà họ cấp. Vì vậy, thường chúng ta phải mua SSL certificate với giá cũng không rẻ lắm. Kỳ thực giá trị của SSL certificate không chỉ ở bản thân giấy chứng nhận, mà nó con bao gồm một phần không nhỏ giá thương hiệu của người bán.</p> <p>Thực ra chữ ký của CA cũng cần phải được xác thực. Giống như chúng ta kiểm tra lại chữ ký của công chứng viên vậy. Các certificate của CA sẽ được chứng nhận bởi những CA cấp cao hơn, và quá trình này là một quá trình đệ quy như sau:</p> <p><img alt="validation chain" src=https://i.imgur.com/W2LNdeM.gif></p> <p>Mỗi certificate sẽ được chứng nhận bằng certificate cấp cao hơn, và cấp cao nhất gọi là CA Root certificate. CA Root certificate cũng là một SSL certificate, nhưng nó dùng để xác thực và gắn chữ ký điện tử cho các certificate thương mại được bán cho người dùng. Những root certificate này thường được cài đặt sẵn trên trình duyệt và khi trình duyệt nhận certificate từ website nào đó, nó sẽ dùng root certificate để kiểm tra những certificate nhận được có hợp lệ hay không.</p> <p>Nhờ quá trình xác thực trên, mà khi sử dụng HTTPS, chúng ta không chỉ đơn giản mã hóa thông tin, mà chúng ta còn chứng thực được mình đang làm việc với đúng đối tượng mà chúng ta muốn.</p> <p>Vì quá trình xác thực, mã hóa và giải mã rất phức tạp như trên, nên HTTPS tốn nhiều thời gian để xử lý hơn HTTP. Trong nhiều trường hợp HTTPS là không cần thiết, nhiều hãng lớn như <a href=http://edition.cnn.com/ >CNN</a>, <a href=http://www.bbc.com/ >BBC</a> không sử dụng HTTPS cho trang Web của họ, đơn giản vì nó là các trang tin tức, không có thông tin nhạy cảm nào mà việc phản hồi nhanh với người dùng quan trọng hơn.</p> <h1 id=https-co-thuc-su-bao-mat>HTTPS có thực sự bảo mật?<a class=headerlink href=#https-co-thuc-su-bao-mat title="Permanent link">&para;</a></h1> <p>Trong nhiều trường hợp, HTTPS với dấu hiệu màu xanh trên thanh địa chỉ là dấu hiện cho thấy những gì chúng ta thao tác sẽ được bảo mật. Nhưng liệu nó đã đủ bảo mật hay chưa? Ý kiến cá nhân của tôi là chưa. HTTPS cũng giống như bạn ra khỏi ra mà khóa kín cửa vậy. Kỳ thực khóa cửa chỉ phòng người ngay chứ chẳng tránh được kẻ gian. Nếu có kẻ đã cố tính vào nhà ăn trộm thì khóa cửa chắc mấy cũng chỉ cần cắt một nhát là đứt. HTTPS có lẽ có phần tương tự như vậy.</p> <h2 id=voi-may-chu-va-web-app>Với máy chủ và Web app<a class=headerlink href=#voi-may-chu-va-web-app title="Permanent link">&para;</a></h2> <p>HTTPS là một cơ chế bảo mật giao dịch giữa người dùng và máy chủ. Có thể nói, đối với máy chủ Web cũng như các ứng dụng Web, nó không có tác dụng gì trong việc bảo mật máy chủ và ứng dụng.</p> <p>Việc bảo mật ứng dụng cần rất nhiều quá trình phức tạp, bao gồm chống tấn công DDoS, chống XSS, CSRF, v.v..</p> <h2 id=voi-nguoi-dung>Với người dùng<a class=headerlink href=#voi-nguoi-dung title="Permanent link">&para;</a></h2> <p>Vậy với người dùng thì sao? Chẳng phải HTTPS giúp người dùng mã hóa dữ liệu, xác thực máy chủ hay sao? Câu trả lời thật phũ phàng là vẫn có rất nhiều cách để phá vỡ HTTPS. Tạm thời chưa nói đến các phương thức mã hóa có những lỗ hổng nhất định, vẫn còn rất nhiều phương pháp khác nhau để phá bỏ hệ thống xác thực certificate:</p> <ul> <li>Đột nhập vào hệ thống của CA. Như chúng ta đã biết, có hàng trăm <a href=https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins/certdata.txt>CA được trình duyệt tin tưởng</a>. Những kẻ tấn công chỉ cần tìm một trong số các CA này có khả năng đột nhập là đủ. Và thực tế thì <a href=https://www.eff.org/deeplinks/2011/08/iranian-man-middle-attack-against-google>chuyện này cũng đã từng xảy ra</a> với những hậu quả thật khủng khiếp.</li> <li>Đột nhập các router gần CA hoặc gần nạn nhân, đọc và giả mạo các gói tin DNS đến và đi, tấn công việc trao đổi email giữa nạn nhân và CA. Các phương thức mã hóa email không giúp ích được gì trong trường hợp này, vì <a href=https://en.wikipedia.org/wiki/STARTTLS>STARTTLS</a> hoàn toàn có thể bị phá vỡ.</li> <li>Đột nhập các máy chủ DNS được sử dụng với CA hoặc giả mạo các gói tin DNS với domain của nạn nhân. Nhiều khi <a href=http://www.linuxjournal.com/content/understanding-kaminskys-dns-bug>việc này khá dễ dàng</a>.</li> <li>Tấn công một số giao thức mạng khác, ví dụ TCP, để tấn công các gói tin của nạn nhân.</li> <li>Một số CA có thể bị chính quyền nước sở tại bắt buộc cung cấp certificate độc hại như <a href=https://www.ifca.ai/pub/fc11/20.pdf>đã từng bị</a>. Bởi vì CA có mặt ở rất nhiều quốc gia khác nhau mà nhiều chính phủ có thể tìm cách yêu cầu CA làm như vậy.</li> </ul> <p>Trên đây là những vẫn đề của hệ thống ngoài khiến dữ liệu của chúng ta vẫn có thể bị đánh cắp dù HTTPS vẫn hoạt động tốt. Nhưng ngay cả HTTPS bản thân nó cũng có những vẫn đề nhất định. Ví dụ như lỗ hổng <a href=http://gizmodo.com/how-heartbleed-works-the-code-behind-the-internets-se-1561341209>Heartbleed</a> (trái tim rỉ máu). Lỗ hổng này có khả năng phơi bày các nội dung chứa trong bộ nhớ máy chủ, cho phép kẻ tấn công sao chép các mã khóa của máy chủ. Có được khóa rồi, chúng dễ dàng giải mã các thông tin được trao đổi.</p> <p>Và ngay cả cơ chế xác thực bằng root certificate cũng không hoàn toàn an toàn. Hãy xem kiểu tấn công Man in the Middle như sau:</p> <p><img alt=MitM src=https://i.imgur.com/IXwI846.png></p> <p>Ví dụ, bạn cần vào <a href=https://www.gmail.com>https://www.gmail.com</a>, nhưng có kẻ nào đó giả crack vào quá trình trao đổi giữa bạn và máy chủ. Và bạn tin tưởng rằng, với certificate đã được chứng thực, bạn có thể yên tâm rằng mình an toàn, những kết nối với máy chủ không phải Gmail sẽ không thể được xác thực bằng SSL certificate.</p> <p>Nhưng bạn đã nhầm rồi.</p> <p>Những gì thực sự có thể diễn ra rất khác với bạn tưởng tượng:</p> <ol> <li>Bạn kết nối đến <a href=https://www.gmail.com>https://www.gmail.com</a></li> <li>Kẻ tấn công chuyển hướng truy vấn của bạn đến máy chủ hắn đã chuẩn bị sẵn.</li> <li>Vì máy chủ này chứa SSL certificate hoàn toàn hợp lệ, trình duyệt của bạn sẽ không thể biết được bạn đã kết nối sai máy chủ.</li> <li>Bạn thao tác với máy chủ giả, mọi dữ liệu sẽ bị kẻ tấn công đọc được, hắn ta có thể thay đổi nó, và gửi nó cho máy chủ Gmail thật.</li> <li>Bạn hoàn toàn không hề hay biết rằng kết nối được bảo mật của mình hoàn toàn không hề bảo mật.</li> </ol> <p>Tại sao kẻ tấn công có thể có được SSL certificate hợp lệ? Kẻ tấn công có thể lợi dụng root certificate (được cài đặt sẵn trong các trình duyệt, mà trình duyệt mã nguồn mở thì không thiếu) để tạo ra các SSL certificate cho website của hắn. Nếu vậy thì có trời mới biết thứ nào là thật, thứ nào là giả.</p> <p>Nói một cách ngắn gọn, có rất nhiều con đường khác nhau để bẻ khóa HTTPS.</p> <blockquote> <p>No system is safe</p> </blockquote> <p>Các giao thức bảo mật Web có thể đủ tốt để phòng chống những kẻ tấn công vãng lai, không có nhiều thời gian và động lực. Nhưng nó vẫn còn quá nhỏ bé trong một thế giới mà công nghệ và các phương thức tấn công ngày càng phát triển.</p> <h2 id=vi-du-minh-hoa>Ví dụ minh họa<a class=headerlink href=#vi-du-minh-hoa title="Permanent link">&para;</a></h2> <p>Mời các bạn thử sức với bài CTF sau, đây sẽ là một ví dụ minh họa đơn giản cho thấy HTTPS dễ bị tổn thương như thế nào?</p> <p><a href=http://ksnctf.sweetduet.info/problem/33>http://ksnctf.sweetduet.info/problem/33</a></p> <p>Đề bài cho một file pcap, đây là file capture các gói tin trong mạng. Trong file này thể hiện rất rõ ràng quá trình thiết lập kết nối SSL và trao đổi dữ liệu. Sử dụng Wireshark, chúng ta có thể thấy được toàn bộ quá trình trao đổi dữ liệu này.</p> <ol> <li>Client hello, đây là bước mở đầu, trình duyệt thông báo cho máy chủ biết về thuật toán mã hóa.</li> <li>Server hello, đây là bước máy chủ phản hồi rằng đã chấp nhận thuật toán mã hóa của trình duyệt.</li> <li>Certificate, đây là bước máy chủ gửi SSL certificate cho trình duyệt.</li> <li>Change cipher spec, đây là bước trình duyệt gửi cho máy chủ thông tin về session key được sinh ngẫu nhiên.</li> </ol> <p>Tiếp theo là quá trình trao đổi dữ liệu sử dụng session key, như chúng ta có thể thấy, ở packet thứ 12 là Application data, đây là packet HTTP đã được mã hóa bằng session key.</p> <p><img alt="https data" src=https://i.imgur.com/atUj6d9.png></p> <p>Để hiểu được các gói tin này, chúng ta cần phải tìm được private key của server. Trước hết, bằng cách Export selected packet bytes, chúng ta dễ dàng lấy được thông tin public key của certificate nhận được từ máy chủ:</p> <p><img alt=certificate src=https://i.imgur.com/nxaYp2S.png></p> <p>Việc sinh ra public key và private key được thực hiện theo cách thức của <a href=https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Key_generation>RSA</a>. Từ các packet thu được, chúng ta có thể thu được public key của máy chủ</p> <p><img alt="inspect public key" src=https://i.imgur.com/n3cz6gl.png></p> <p>Modulus ở đây là tích của hai thừa số nguyên tố. Chỉ cần phân tích được nó thì chúng ta có thể tìm được private key. Về lý thuyết, việc này là hoàn toàn có thể. Tuy nhiên, việc phân tích nó có thể nói là quá sức của những máy tính cá nhân bình thường, vì giá trị của nó quá lớn. (Tuy nhiên, sau này, <a href=http://computer.howstuffworks.com/quantum-computer.htm>máy tính lượng tử</a> có thể sẽ giải quyết được vấn đề tính toán này)</p> <p>Rất may, chúng ta có thêm gợi ý thứ 2. Ở đây, client đang giao tiếp với hai server (192.168.0.39 và 192.168.0.40). Chúng ta dễ dàng lấy được public key của server thứ 2. Và trong bài toán này, hai server sử dụng public key tương tự nhau, phải chăng chúng có cùng thừa số nguyên tố. Chúng ta sẽ tìm cách lấy chúng ra.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>gcd</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
    <span class=k>while</span> <span class=n>b</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>a</span> <span class=o>%</span> <span class=n>b</span>
        <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>b</span><span class=p>,</span> <span class=n>r</span>
    <span class=k>return</span> <span class=n>a</span>

<span class=n>mod1</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>00:a5:a7:ce:44:46:2e:8a:c6:e4:da:5e:8a:8d:58:</span>
<span class=s2>e0:03:b8:26:75:68:b3:58:10:6c:f0:64:12:88:4c:</span>
<span class=s2>ee:b7:cc:42:51:c2:cc:e2:db:74:68:9d:1a:fa:10:</span>
<span class=s2>9b:de:97:62:40:2e:81:d9:6c:b6:c8:c6:c5:ae:bc:</span>
<span class=s2>8d:45:a9:6b:f2:14:a6:18:b4:99:a8:c6:13:40:35:</span>
<span class=s2>c5:03:9b:f9:a3:9b:c4:71:90:e4:cc:45:60:cb:75:</span>
<span class=s2>ab:8d:63:63:5c:de:e8:e5:0f:58:15:b2:91:80:cc:</span>
<span class=s2>51:a4:c8:cf:76:a8:bb:e6:e6:1c:68:ac:a3:85:fd:</span>
<span class=s2>f9:9e:71:2b:10:a6:be:7e:d7:94:cf:27:54:0b:7a:</span>
<span class=s2>a0:0f:59:da:55:79:04:0a:9b:3b:7c:23:e9:e2:2a:</span>
<span class=s2>15:c2:9e:b0:c0:60:b9:6d:1f:48:d1:c4:58:e2:c4:</span>
<span class=s2>12:51:29:62:ce:5a:f8:85:23:7b:61:38:df:6c:9e:</span>
<span class=s2>85:d1:01:c2:66:c3:b8:0b:02:ff:97:d6:fd:e4:65:</span>
<span class=s2>98:e1:9e:3f:a1:df:2c:56:bd:34:ad:df:e7:16:56:</span>
<span class=s2>9a:2e:d4:2c:64:42:bf:2d:b5:e9:a5:1c:c2:d7:dd:</span>
<span class=s2>44:97:71:7d:dd:9a:8a:66:ae:28:1e:1a:2a:bf:7d:</span>
<span class=s2>f7:a5:97:79:b4:99:cc:0f:81:67:a1:9e:3c:a5:c9:</span>
<span class=s2>bb:e3</span>
<span class=s2>&quot;&quot;&quot;</span>

<span class=n>mod2</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>00:a4:da:ad:49:ea:e0:b5:c5:9d:a0:45:29:78:ae:</span>
<span class=s2>98:7e:1b:96:f1:49:de:db:62:27:4c:97:f9:9a:c4:</span>
<span class=s2>54:4a:a9:0d:b4:aa:f9:a0:96:7f:11:8b:70:09:09:</span>
<span class=s2>7b:cb:0b:ae:b4:a1:96:36:77:7a:77:47:e0:6a:d8:</span>
<span class=s2>44:96:c9:c6:1d:18:a7:b5:ca:77:65:85:a8:17:52:</span>
<span class=s2>6e:d6:d9:f0:f2:ab:d8:c4:34:c6:2c:bf:02:5e:b7:</span>
<span class=s2>ce:5a:83:e4:a7:f9:93:8f:38:62:de:24:e6:29:2f:</span>
<span class=s2>43:27:0f:fd:a7:57:c1:7a:aa:79:7f:f9:fe:18:fd:</span>
<span class=s2>1c:b2:39:21:dc:58:5d:45:50:38:4f:f5:c4:f2:4e:</span>
<span class=s2>6d:fc:6d:4f:44:b5:69:34:58:08:23:92:47:c2:0d:</span>
<span class=s2>26:6c:d0:f5:e3:73:88:9e:d4:e4:59:59:0b:7d:74:</span>
<span class=s2>2d:28:37:c1:c4:8d:cf:94:18:e2:21:91:ab:4a:0b:</span>
<span class=s2>ca:0e:d7:9b:1d:45:c0:ca:5d:36:ea:69:60:c9:36:</span>
<span class=s2>0c:11:41:23:29:fd:5d:90:ff:34:67:f2:d8:2e:23:</span>
<span class=s2>02:1a:df:3b:6d:8b:e2:49:03:b7:6e:ff:c9:38:15:</span>
<span class=s2>4e:c2:19:f3:44:11:8f:1c:41:fe:c3:11:71:b6:29:</span>
<span class=s2>45:a0:7e:35:76:2a:96:1a:05:79:53:89:08:60:52:</span>
<span class=s2>de:c7</span>
<span class=s2>&quot;&quot;&quot;</span>

<span class=n>pubs</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>mod</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)),</span> <span class=mi>16</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>mod</span> <span class=ow>in</span> <span class=p>(</span><span class=n>mod1</span><span class=p>,</span> <span class=n>mod2</span><span class=p>)]</span>

<span class=n>p</span> <span class=o>=</span> <span class=n>gcd</span><span class=p>(</span><span class=o>*</span><span class=n>pubs</span><span class=p>)</span>
</pre></div> <p>Từ đây, chúng ta có thể lấy ra được thừa số nguyên tố còn lại từ Modulus. Việc chúng ta cần làm lúc này khá đơn giản, tìm cách ghi private key ra file theo định dạng <a href=https://en.wikipedia.org/wiki/Privacy-enhanced_Electronic_Mail>PEM</a> để Wireshark hiểu và dự giải mã cho chúng ta là được:</p> <div class=codehilite><pre><span></span><span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>

<span class=kn>from</span> <span class=nn>Crypto.PublicKey</span> <span class=k>import</span> <span class=n>RSA</span>

<span class=k>def</span> <span class=nf>inverse</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
    <span class=n>t</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>newt</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>n</span>
    <span class=n>newr</span> <span class=o>=</span> <span class=n>a</span>
    <span class=k>while</span> <span class=n>newr</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>quotient</span> <span class=o>=</span> <span class=n>r</span> <span class=o>//</span> <span class=n>newr</span>
        <span class=n>t</span><span class=p>,</span> <span class=n>newt</span> <span class=o>=</span> <span class=n>newt</span><span class=p>,</span> <span class=n>t</span> <span class=o>-</span> <span class=n>quotient</span> <span class=o>*</span> <span class=n>newt</span>
        <span class=n>r</span><span class=p>,</span> <span class=n>newr</span> <span class=o>=</span> <span class=n>newr</span><span class=p>,</span> <span class=n>r</span> <span class=o>-</span> <span class=n>quotient</span> <span class=o>*</span> <span class=n>newr</span>
    <span class=k>if</span> <span class=n>r</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>return</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=n>t</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>t</span> <span class=o>=</span> <span class=n>t</span> <span class=o>+</span> <span class=n>n</span>
    <span class=k>return</span> <span class=n>t</span>

<span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>pub</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>pubs</span><span class=p>):</span>
    <span class=n>q</span> <span class=o>=</span> <span class=n>pub</span> <span class=o>//</span> <span class=n>p</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;key</span><span class=si>%d</span><span class=s2>.pem&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
        <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
        <span class=n>comps</span> <span class=o>=</span> <span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>))</span>
        <span class=n>x</span> <span class=o>=</span> <span class=n>RSA</span><span class=o>.</span><span class=n>construct</span><span class=p>(</span><span class=n>comps</span><span class=p>)</span>
        <span class=n>pk</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>exportKey</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>pk</span><span class=p>)</span>
</pre></div> <p>Vậy là chúng ta đã thu được hai file PEM chứa private key của hai máy chủ. Giờ chỉ cần thêm vào cho Wireshark là được</p> <p><img alt="add pem file" src=https://i.imgur.com/4zfpzwb.png></p> <p><img alt="add keys" src=https://i.imgur.com/B0ZUg7s.png></p> <p>Vậy là đủ, Wireshark sẽ giải mã các gói tin cho chúng ta, lúc này chúng ta có thể thấy được các packet HTTP</p> <p><img alt="decrypted packet" src=https://i.imgur.com/a4haAUR.png></p> <p>Và dễ dàng lấy được những thông tin chúng ta cần.</p> <p><img alt=flag src=https://i.imgur.com/DrpT4Tk.jpg></p> <p>Có thể nói rằng đây chỉ là một bài CTF nên người ra đề đã cố tình để lộ ra một vài sơ hở. Nhưng cũng nên nhớ rằng, tôi cũng chỉ là "tay mơ" đang tập tành chơi, còn ngoài kia có biết bao nhiêu người tài năng khác, họ có thể tìm ra lỗ hổng bảo mật ngay cả khi mà người thiết kế giao thức vẫn còn chưa nghĩ đến nó.</p> <h1 id=ket-luan>Kết luận<a class=headerlink href=#ket-luan title="Permanent link">&para;</a></h1> <p>HTTPS thực sự chỉ đủ bảo mật ở mức độ chấp nhận được. Nếu muốn thực sự an toàn trên Internet, chúng ta cần nhiều biện pháp hơn thế. HTTPS cũng giống như bạn ra khỏi nhà mà khóa cửa, phần lớn chúng ta vẫn tạm hài lòng với tình trạng như vậy, nhưng vẫn có nhiều người chưa hẳn yên tâm và còn phải khóa thêm vài lớp, mua thêm két sắt để cất giữ đồ đạc quan trọng.</p> </div> <div class=post-footer> <div class=tags> <i class="fa fa-tags"></i> <span>#Security</span> <span>#Cryptography</span> <span>#HTTPS</span> <span>#SSL</span> <span>#TLS</span> <span>#crack</span> <span>#CTF</span> </div> </div> </div><div class=blog-pager> <span class=newer-link> <a href=/2017/Jan/13/tam-dao-travel.html> Newer Post </a> </span> <span class=older-link> <a href=/2016/Dec/14/react-es6-autobind-does-not-work.html> Older Post </a> </span> </div><div class=comments> <div class=finally> <p><em>I apologise for any typos. If you notice a problem, please let me know.</em> <p>Thank you all for your attention. </div> <div id=disqus_thread></div> <script src=/theme/js/disqus.min.js?81e8a5f5></script> <noscript> Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript> comments powered by Disqus. </a> </noscript> </div></div> </div> </div> <div class=sidebar-wrapper> <div class=widget> <h2>Welcome</h2> <div> <img src=/theme/images/banner.gif alt=Welcome> </div> </div><div class="widget recent-posts"> <h2>Recent Posts</h2> <ul> <li> <a href=/2019/May/20/elasticsearch-data-organization.html> <img alt="Elasticsearch: Data organization" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-data-organization.html>Elasticsearch: Data organization</a> <li> <a href=/2019/May/20/elasticsearch-intro.html> <img alt="Elasticsearch: Intro" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-intro.html>Elasticsearch: Intro</a> <li> <a href=/2019/Apr/20/javascript-popups.html> <img alt="JavaScript: Popups" src=https://i.imgur.com/FxmcwPy.png> </a> <a href=/2019/Apr/20/javascript-popups.html>JavaScript: Popups</a> <li> <a href=/2019/Mar/20/javascript-iterator-and-generator.html> <img alt="JavaScript: Iterator and generator" src=https://i.imgur.com/lev8iT9.jpg> </a> <a href=/2019/Mar/20/javascript-iterator-and-generator.html>JavaScript: Iterator and generator</a> <li> <a href=/2019/Feb/20/javascript-decorator.html> <img alt="JavaScript decorator" src=https://i.imgur.com/Sh3yLI0.png> </a> <a href=/2019/Feb/20/javascript-decorator.html>JavaScript decorator</a> </ul> </div><div class="widget labels"> <h2>Blog Archive</h2> <ul> <li> <a href=/2019/ > 2019 </a> <li> <a href=/2018/ > 2018 </a> <li> <a href=/2017/ > 2017 </a> <li> <a href=/2016/ > 2016 </a> <li> <a href=/2015/ > 2015 </a> <li> <a href=/2014/ > 2014 </a> <li> <a href=/2013/ > 2013 </a> <li> <a href=/2012/ > 2012 </a> <li> <a href=/2011/ > 2011 </a> <li> <a href=/2010/ > 2010 </a> </ul> </div><div class=widget> <h2>Twitter timeline</h2> <a class=twitter-timeline data-height=500 data-dnt=true data-theme=light href=https://twitter.com/_naa_4f data-chrome="noheader nofooter transparent noborders"> Tweets by manhhomienbienthuy </a> </div> </div> </div> <a href=# class="smooth-scroll back-to-top"> <i class="fa fa-arrow-circle-up fa-3x"></i> </a> </main> <footer> <div class=infos> <div class=wrapper> <div class=widget> <a href=/ title="manhhomienbienthuy's space" class=logo> <img alt="manhhomienbienthuy's space" src=/theme/images/logo_white.png> </a> <span class=right>I'm a hacker, enter my world...</span> </div><div class=widget> <p> Created with all my ♥ and soul, dedicated to my love, yunachan <p> Powered by <a href=http://blog.getpelican.com/ target=_blank>Pelican</a>, which takes great advantage of <a href=https://www.python.org/ target=_blank>Python</a> <p> This site content is licensed under a <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank> CC BY-NC-ND 4.0 </a> License. <p> Updated at <a target=_blank href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=2019-06-20T02:42:55"> 2019-06-20 02:42:55 </a> </div><div class=widget> <p> Hosting by <a href=https://manhhomienbienthuy.bitbucket.io/ >Bitbucket</a> and <a href=https://manhhomienbienthuy.github.io/ >Github</a>, image hosting by <a href=https://manhhomienbienthuy.imgur.com/ target=_blank>imgur</a>, <a href=https://instagram.com/manhhomienbienthuy/ target=_blank>Instagram</a> and <a href=https://photos.google.com/ target=_blank>Google Photo</a> <p> Theme based on <a href=https://vanice-veethemes.blogspot.com/ target=_blank>Vanice theme</a>, icons from <a href=https://fontawesome.com/ target=_blank>Font Awesome</a>, comments powered by <a href=https://disqus.com/home/forums/manhhomienbienthuy/ target=_blank>Disqus</a> </div> </div> </div> <div class=credits> <div class=wrapper> <div class=left> <!--
          Regarding copyright, in general, standalone pages (as
          opposed to files generated as part of manuals) on the GNU
          web server should be under CC BY-ND 4.0.  Please do NOT
          change or remove this without talking with the webmasters or
          licensing team first.  Please make sure the copyright date
          is consistent with the document.  For web pages, it is ok to
          list just the latest year the document was modified, or
          published.

          If you wish to list earlier years, that is ok too.  Either
          "2001, 2002, 2003" or "2001-2003" are ok for specifying
          years, as long as each year in the range is in fact a
          copyrightable year, i.e., a year in which the document was
          published (including being publicly visible on the web or in
          a revision control system).
        --> Copyright © 2010-2019 <a href=/pages/about-me.html><strong>manhhomienbienthuy</strong></a>. All rights reserved. </div> <div class=right> <ul> <li><a href=/ >Home</a> <li><a href=/pages/about-me.html>About</a> <li><a href=# class=smooth-scroll>Top ↑</a> </ul> </div> </div> </div></footer> <script src=https://code.jquery.com/jquery-3.2.1.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js></script> <script src=/theme/js/vpyeu.min.js?d72c87bd></script> <script id=dsq-count-scr src=https://manhhomienbienthuy.disqus.com/count.js async></script>