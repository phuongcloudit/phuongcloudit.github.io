<!DOCTYPE html><title>Django: Abstract Base Classes vs Multiple Table Inheritance - manhhomienbienthuy's space</title> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=apple-touch-icon href=/theme/images/icon-touch.png> <link rel=icon sizes=192x192 href=/theme/images/icon-touch.png> <link rel="shortcut icon" href=/theme/images/favicon.ico> <link rel=author href=/humans.txt> <meta name=msapplication-TileImage content=/theme/images/icon-tile.png> <meta name=twitter:dnt content=on> <meta name=Author content=manhhomienbienthuy> <meta name=rating content=general> <meta name=twitter:card content=product> <meta name=twitter:site content=@_naa_4f> <meta name=twitter:creator content=@_naa_4f> <link href=/feeds/all.atom.xml type=application/atom+xml rel=alternate title="manhhomienbienthuy's space Full Atom Feed"> <meta name=description content="Django là một framework rất đầy đủ của Python cho phép chúng ta có thể phát triển nhanh một trang Web với những tính năng mạnh mẽ. Django đã cho phép kế thừa các model từ cách đây khá lâu, khi QuerysetRefactor branch được merge. Điều này cho phép chúng …"> <meta name=keywords content="Django, Python, Inheritance, Multi-table, Abstract, blog, naa, manhhomienbienthuy, pelican, static site generator"> <meta name=twitter:title content="Django: Abstract Base Classes vs Multiple Table Inheritance - manhhomienbienthuy's space"> <meta name=twitter:description content="Django là một framework rất đầy đủ của Python cho phép chúng ta có thể phát triển nhanh một trang Web với những tính năng mạnh mẽ. Django đã cho phép kế thừa các model từ cách đây khá lâu, khi QuerysetRefactor branch được merge. Điều này cho phép chúng …"> <meta name=twitter:image content=/https://i.imgur.com/FuZ3Phj.png> <link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css> <link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css> <link rel=stylesheet href=/theme/css/vpyeu.min.css?5d2c7d5e> <header> <div class=navbar> <div class=wrapper> <div class=nav-menu> <div class=menu-toggle> <i class="fa fa-reorder"></i> </div> <ul class=menus> <li><a href=/ >Home</a> <li><a href=/category/general.html> General <li><a href=/category/life.html> Life <li><a href=/category/programming.html class=current> Programming <li><a href=/category/travel.html> Travel </ul> </div><div class="right links"> <ul> <li> <a href=https://twitter.com/_naa_4f target=_blank> <i class="fa fa-twitter"></i> </a> <li> <a href=https://instagram.com/manhhomienbienthuy/ target=_blank> <i class="fa fa-instagram"></i> </a> <li> <a href=https://www.facebook.com/manhhomienbienthuy target=_blank> <i class="fa fa-facebook"></i> </a> <li> <a href=https://github.com/manhhomienbienthuy target=_blank> <i class="fa fa-github"></i> </a> <li> <a href=/feeds/all.atom.xml target=_blank> <i class="fa fa-rss"></i> </a> </ul> </div> </div> </div><noscript> <div class="warning head-warn"> <div class=wrapper> <p><strong>Notice:</strong> While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </div> </div> </noscript><div class=banner> <div class=wrapper> <a href=/ > <img alt="manhhomienbienthuy's space" src=/theme/images/logo.png> </a> </div> </div></header> <main> <div class=wrapper> <div class=main-wrapper> <div class=entry> <div class=entry-detail> <div class=post> <h1 class=title> Django: Abstract Base Classes vs Multiple Table Inheritance </h1> <div class=meta> Posted in <a href=/category/programming.html>Programming</a> on February 02, 2016 by <a href=/pages/about-me.html>manhhomienbienthuy</a> <span class=right> <i class="fa fa-comments"></i> <a href=#disqus_thread data-disqus-identifier=/2016/Feb/02/django-abstract-base-classes-vs-multiple-table-inheritance.html> Comments </a> </span> </div> <div class=post-body> <img src=https://i.imgur.com/FuZ3Phj.png alt="Django: Abstract Base Classes vs Multiple Table Inheritance"> <p>Django là một framework rất đầy đủ của Python cho phép chúng ta có thể phát triển nhanh một trang Web với những tính năng mạnh mẽ. Django đã cho phép kế thừa các model từ cách đây khá lâu, khi <a href=https://code.djangoproject.com/wiki/QuerysetRefactorBranch>QuerysetRefactor branch</a> được merge. Điều này cho phép chúng ta tái sử dụng các code, giảm thiểu số lượng code thừa và tăng productivity. Trong bài viết này, chúng ta sẽ tìm hiểu một số cách để kế thừa model, xem chuyện gì thực sự diễn ra ở database. Từ đó, chúng ta có thể lựa chọn phương án phù hợp nhất cho công việc mình cần.</p> <h1 id=mo-au>Mở đầu<a class=headerlink href=#mo-au title="Permanent link">&para;</a></h1> <p>Khi xây dựng những ứng dụng Web, thỉnh thoảng tôi có gặp trường hợp một số model có cấu trúc gần giống nhau. Chúng giống nhau phần lớn các thuộc tính và chỉ khác biệt một số lượng rất ít (chỉ một hoặc hai) thuộc tính. Khi làm việc với framework Ruby on Rails, tôi thấy nó có tính năng khá hay là <a href=http://api.rubyonrails.org/classes/ActiveRecord/Inheritance.html>Single Table Inheritance</a> (STI) cho phép các model kế thừa nhau mà chỉ sử dụng một bảng duy nhất. Đây là tính năng rất cần thiết cho những tình huống như thế này.</p> <p>Nhưng Django thì có vẻ lại không có tính năng đó. Sau một thời gian tìm hiểu, thì tôi cũng biết cách làm việc tương tự với Django là Multiple Table Inheritance (MTI) và Abstract Base Class (ABC).</p> <p>Tuy nhiên, bài viết này sẽ không giới thiệu cách dùng những tính năng trên, bởi <a href=https://docs.djangoproject.com/en/1.9/topics/db/models/#model-inheritance>tài liệu của django</a> đã rất đầy đủ. Tôi cũng không sa đà vào thảo luận những vấn đề hay hạn chế của chúng. Bạn có thể tìm hiểu tài liệu, thử trên máy của mình, và vào <a href=https://groups.google.com/forum/#!forum/django-users>forums</a> nếu bạn có bất cứ thắc mắc nào.</p> <p>Mục tiêu của bài viết này là review lại những phương án có thể sử dụng để kế thừa model nhằm giảm thiểu code (để giữ code DRY), đó là Model Table Inheritance - MTI (kế thừa bảng model), Abstract Base Classes - ABC (các class trừu tượng làm cơ sở) và <code>OneToOneField</code> (liên kết bảng). Chúng ta sẽ xem xét định nghĩa các model, kiểm tra các truy vấn SQL và cú pháp để lấy kết quả các thuộc tính của model, và hiệu năng của những phương án này.</p> <blockquote> <p>Trước khi bắt đầu, chúng ta sẽ sử dụng một project có sẵn trên máy, tạo một app <code>demo</code> để thử nghiệm các phương án của chúng ta. Những code trong bài viết này hoàn toàn là một ví dụ và nó có thể rất khác so với thực tế.</p> </blockquote> <h1 id=multiple-table-inheritance-mti>Multiple Table Inheritance (MTI)<a class=headerlink href=#multiple-table-inheritance-mti title="Permanent link">&para;</a></h1> <p>Chúng ta sẽ tìm hiểu qua 2 model, đó là <code>ContentItemBase</code> và <code>Post</code>. Model <code>Post</code> sẽ kế thừa từ model <code>ContentItemBase</code>. Model <code>ContentItemBase</code> sẽ là "base" cho các model khác kế thừa. Bây giờ tôi có model <code>Post</code> nhưng sau này tôi có thể thêm vào các model <code>Diary</code>, <code>Photo</code>, <code>Video</code>, v.v...</p> <p>Dưới đây là định nghĩa của model <code>ContentItemBase</code>:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>ContentItemBase</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>COMMENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=s1>&#39;Open&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Closed&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=n>DEFAULT_COMMENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;0&#39;</span>
    <span class=n>CONTENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Draft&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=s1>&#39;Public&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=n>DEFAULT_CONTENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>

    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
                             <span class=n>unique_for_date</span><span class=o>=</span><span class=s2>&quot;publish_on&quot;</span><span class=p>)</span>
    <span class=n>slug</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>SlugField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;slug&#39;</span><span class=p>))</span>
    <span class=n>created_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;created on&#39;</span><span class=p>),</span> <span class=n>auto_now_add</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                                      <span class=n>editable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=p>)</span>
    <span class=n>updated_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;updated on&#39;</span><span class=p>),</span> <span class=n>editable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
    <span class=n>publish_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;publish on&#39;</span><span class=p>),</span> <span class=p>)</span>
    <span class=n>tags</span> <span class=o>=</span> <span class=n>TagField</span><span class=p>()</span>
    <span class=n>status</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>(</span>
        <span class=n>_</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>),</span>
        <span class=n>choices</span><span class=o>=</span><span class=n>CONTENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_CONTENT_STATUS</span><span class=p>,</span>
        <span class=n>db_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>
    <span class=n>comment_status</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>(</span>
        <span class=n>_</span><span class=p>(</span><span class=s1>&#39;comment status&#39;</span><span class=p>),</span>
        <span class=n>choices</span><span class=o>=</span><span class=n>COMMENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_COMMENT_STATUS</span><span class=p>,</span>
        <span class=n>db_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=k>pass</span>
</pre></div> <p>Bây giờ, chúng ta cần định nghĩa model <code>Post</code>, model này có khá nhiều thuộc tính chia sẻ với những model khác, chính là những thuộc tính của model <code>ContentItemBase</code> ở trên. Làm thế nào chúng ta có thể dùng lại những thuộc tính đó cho các model khác nhau? Tôi nghĩ chúng ta đoán cũng được, đó là kế thừa lại model <code>ContentItemBase</code>. Chúng ta sẽ xem qua một định nghĩa của model <code>Post</code> như dưới đây:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>ContentItemBase</span><span class=p>):</span>
    <span class=n>DEFAULT_INPUT_FORMAT</span> <span class=o>=</span> <span class=s1>&#39;X&#39;</span>
    <span class=n>INPUT_FORMAT_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;X&#39;</span><span class=p>,</span><span class=s1>&#39;XHTML&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span><span class=s1>&#39;Markdown&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;R&#39;</span><span class=p>,</span><span class=s1>&#39;Resructured Text&#39;</span><span class=p>),</span>
    <span class=p>)</span>

    <span class=n>teaser</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;teaser&#39;</span><span class=p>),</span> <span class=n>blank</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</pre></div> <p>Không có gì đặc biệt ở đây? Ngoại trừ việc model <code>Post</code> không kế thừa từ <code>models.Model</code> như bình thường mà kế thừa từ một model khác là <code>ContentItemBase</code>. Điều đó có nghĩa là gì? Đơn giản chỉ là model <code>Post</code> có thể truy cập đến toàn bộ thuộc tính của model mà nó kế thừa - <code>ContentItemBase</code>. Vì vậy, chúng ta không cần khai báo lại những thuộc tính như <code>title</code>, v.v trong model <code>Post</code> mà nó vẫn có những thuộc tính này. Bởi vì <code>Post</code> là con của <code>ContentItemBase</code> và nó sẽ kế thừa những thuộc tính từ model cha. Để biết rõ hơn về cấu trúc cơ sở dữ liệu với những model này, chúng ta sẽ xem schema được sinh ra bởi 2 model trên.</p> <div class=codehilite><pre><span></span><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=ss>&quot;demo_contentitembase&quot;</span> <span class=p>(</span>
    <span class=ss>&quot;id&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>AUTOINCREMENT</span><span class=p>,</span>
    <span class=ss>&quot;title&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;slug&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;created_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;updated_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;publish_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;tags&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;comment_status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span>
<span class=p>);</span>

<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=ss>&quot;demo_post&quot;</span> <span class=p>(</span>
    <span class=ss>&quot;contentitembase_ptr_id&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=k>REFERENCES</span> <span class=ss>&quot;demo_contentitembase&quot;</span> <span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>),</span>
    <span class=ss>&quot;teaser&quot;</span> <span class=nb>text</span> <span class=k>NOT</span> <span class=k>NULL</span>
<span class=p>);</span>
</pre></div> <p>Có gì hot? Ở tầng cơ sở dữ liệu, Django tạo ra 2 bảng - một bảng cho model <code>ContentItemBase</code> và một bảng cho model <code>Post</code>. Hai bảng này quan hệ 1:1 với nhau. Bảng <code>demo_posts</code> có một trường là <code>contentitembase_ptr_id</code>, trường này sẽ lưu ID của bảng <code>demo_contentitembase</code>.</p> <p>Vì có hai bảng, nên khi chúng ta query, chúng ta sẽ phải join hai bảng này với nhau. Đây không phải là điều gì xấu cả. Tuy nhiên, trong trường hợp cơ sở dữ liệu của bạn lớn, có thể bạn cần để ý xem có bao nhiêu bảng được join với nhau và chúng được thực hiện thường xuyên hay không. Bởi những việc này có ảnh hướng không nhỏ tới hiệu năng của hệ thống.</p> <p>Quay trở lại với ví dụ của chúng ta, bây giờ, nếu chúng ta cần lấy ra thuộc tính <code>title</code> của <code>Post</code>. Chúng ta sẽ thực hiện như thế nào?</p> <p>Trước hết, lấy ra bản ghi có <code>ID = 1</code> từ cơ sở dữ liệu:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=n>p</span> <span class=o>=</span> <span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>p</span><span class=o>.</span><span class=n>title</span>
<span class=go>&#39;foobar&#39;</span>
</pre></div> <p>Bây giờ, chúng ta sẽ xem xét câu lệnh query được gọi. Liệu câu lệnh SQL nào đã được thực thi để lấy ra instance <code>Post</code> từ cơ sở dữ liệu. Có thể bạn sẽ để ý rằng, trong ví dụ trên, khi lấy thuộc tính <code>title</code>, tôi không hề tham chiếu đến model <code>ContentItemBase</code> hay bảng của nó trên database. Đây là một tính năng tự động Django đã làm cho chúng ta.</p> <p>Nếu bạn sử dụng khóa ngoài hay <code>OneToOneField</code> thì ở đây, bạn sẽ phải tham chiếu đến <code>title</code> thông qua <code>ContentItemBase</code>, kiểu như <code>post.contentitembase.title</code> bởi vì đây là hai bảng riêng biệt và câu lệnh trên sẽ tham chiếu đến bảng được liên kết.</p> <p>Nhưng trong ví dụ của chúng ta, không một lệnh tham chiếu nào được gọi. Như những gì chúng ta thấy, <code>title</code> dường như là một thuộc tính của <code>Post</code> chứ không phải thuộc tính của bảng tham chiếu nữa. Và chúng ta có thể lấy giá trị của thuộc tính này rất dễ dàng. Điều gì đã xảy ra, hãy xem câu lệnh SQL cho truy vấn trong trường hợp này.</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connection</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>connection</span><span class=o>.</span><span class=n>queries</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<span class=go>{&#39;sql&#39;: &#39;SELECT &quot;demo_contentitembase&quot;.&quot;id&quot;, &quot;demo_contentitembase&quot;.&quot;title&quot;, &quot;demo_contentitembase&quot;.&quot;slug&quot;, &quot;demo_contentitembase&quot;.&quot;created_on&quot;, &quot;demo_contentitembase&quot;.&quot;updated_on&quot;, &quot;demo_contentitembase&quot;.&quot;publish_on&quot;, &quot;demo_contentitembase&quot;.&quot;tags&quot;, &quot;demo_contentitembase&quot;.&quot;status&quot;, &quot;demo_contentitembase&quot;.&quot;comment_status&quot;, &quot;demo_post&quot;.&quot;contentitembase_ptr_id&quot;, &quot;demo_post&quot;.&quot;teaser&quot; FROM &quot;demo_post&quot; INNER JOIN &quot;demo_contentitembase&quot; ON (&quot;demo_post&quot;.&quot;contentitembase_ptr_id&quot; = &quot;demo_contentitembase&quot;.&quot;id&quot;) WHERE &quot;demo_post&quot;.&quot;contentitembase_ptr_id&quot; = 1&#39;, &#39;time&#39;: &#39;0.001&#39;}</span>
</pre></div> <p>Tôi nghĩ mình đã hiểu chuyện gì đã xảy ra. Có một lệnh <code>JOIN</code> đã được thực hiện ở đây:</p> <div class=codehilite><pre><span></span><span class=k>INNER</span> <span class=k>JOIN</span> <span class=ss>&quot;demo_contentitembase&quot;</span> <span class=k>ON</span> <span class=p>(</span><span class=ss>&quot;demo_post&quot;</span><span class=p>.</span><span class=ss>&quot;contentitembase_ptr_id&quot;</span> <span class=o>=</span> <span class=ss>&quot;demo_contentitembase&quot;</span><span class=p>.</span><span class=ss>&quot;id&quot;</span><span class=p>)</span>
</pre></div> <p>Vậy, MTI có lợi ích như thế nào? Chúng ta có thể truy cập đến các thuộc tính rất trực quan, và cơ sở dữ liệu được tổ chức khá rõ ràng với các bảng cha và con liên kết với nhau. Điều này là tốt hay xấu? Nó phụ thuộc vào bài toán thực tế mà bạn cần giải quyết. Tuy nhiên, trước khi đưa ra nhận xét về cách làm này, chúng ta sẽ xem xét thêm một cách làm khác: Abstract Base Classes.</p> <h1 id=abstract-base-classes-abc>Abstract Base Classes (ABC)<a class=headerlink href=#abstract-base-classes-abc title="Permanent link">&para;</a></h1> <p>Vẫn lấy ví dụ giống như phần trước, chúng ta sẽ sử dụng lại hai model là <code>ContentItemBase</code> và <code>Post</code> với một chút biến đổi. Trong phần này chúng ta sẽ xem xét sự khác biệt của ABC và MTI. Sự khác biệt rất dễ dàng nhận ra. Hãy xem định nghĩa của <code>ContentItemBase</code> sau đây:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>ContentItemBase</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>COMMENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=s1>&#39;Open&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Closed&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=n>DEFAULT_COMMENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;0&#39;</span>
    <span class=n>CONTENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Draft&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=s1>&#39;Public&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=n>DEFAULT_CONTENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>

    <span class=n>title</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
                             <span class=n>unique_for_date</span><span class=o>=</span><span class=s2>&quot;publish_on&quot;</span><span class=p>)</span>
    <span class=n>slug</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>SlugField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;slug&#39;</span><span class=p>))</span>
    <span class=n>created_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;created on&#39;</span><span class=p>),</span> <span class=n>auto_now_add</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                                      <span class=n>editable</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=p>)</span>
    <span class=n>updated_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;updated on&#39;</span><span class=p>),</span> <span class=n>editable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
    <span class=n>publish_on</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;publish on&#39;</span><span class=p>),</span> <span class=p>)</span>
    <span class=n>tags</span> <span class=o>=</span> <span class=n>TagField</span><span class=p>()</span>
    <span class=n>status</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>(</span>
        <span class=n>_</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>),</span>
        <span class=n>choices</span><span class=o>=</span><span class=n>CONTENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_CONTENT_STATUS</span><span class=p>,</span>
        <span class=n>db_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>
    <span class=n>comment_status</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>(</span>
        <span class=n>_</span><span class=p>(</span><span class=s1>&#39;comment status&#39;</span><span class=p>),</span>
        <span class=n>choices</span><span class=o>=</span><span class=n>COMMENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_COMMENT_STATUS</span><span class=p>,</span>
        <span class=n>db_index</span><span class=o>=</span><span class=kc>True</span>
    <span class=p>)</span>

    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>abstract</span> <span class=o>=</span> <span class=kc>True</span>
</pre></div> <p>Không khác biệt gì nhiều? Nếu nhìn code thì đúng là như vậy. Chỉ có một thứ duy nhất thay đổi, đó là subclass <code>Meta</code> bây giờ được cài đặt là <code>abstract = True</code>. Đây cũng là một thay đổi rất quan trọng. Ở ví dụ trước, chúng ta chỉ <code>pass</code> cho subclass <code>Meta</code> mà thôi, nghĩa là chúng ta không cài đặt bất cứ thứ gì cho nó.</p> <p>Trong ví dụ này, <code>abstract = True</code> sẽ chỉ thị cho Django về model này - đó là lý do tạo sao chúng ta cần subclass <code>Meta</code>. Nội dung của <code>Meta</code> trong trường hợp này chỉ đơn giản là khai báo với Django rằng, đây là một class trừu tượng, và Django sẽ thao tác với class này như những class trừu tượng khác. Chỉ một dòng code thay đổi, nhưng sự thay đổi bên trong mới thực sự tạo nên sự khác biệt.</p> <p>Hãy xem định nghĩa của model <code>Post</code> như dưới đây:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>ContentItemBase</span><span class=p>):</span>
    <span class=n>DEFAULT_INPUT_FORMAT</span> <span class=o>=</span> <span class=s1>&#39;X&#39;</span>
    <span class=n>INPUT_FORMAT_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;X&#39;</span><span class=p>,</span><span class=s1>&#39;XHTML&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span><span class=s1>&#39;Markdown&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;R&#39;</span><span class=p>,</span><span class=s1>&#39;Resructured Text&#39;</span><span class=p>),</span>
    <span class=p>)</span>

    <span class=n>teaser</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;teaser&#39;</span><span class=p>),</span> <span class=n>blank</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</pre></div> <p>Giống hệt như ví dụ của MTI? Chính xác, không có gì thay đổi với class con <code>Post</code> kế thừa từ <code>ContentItemBase</code>. Cả hai ví dụ, nó đều kế thừa từ class cha, nên chúng ta không cần thay đổi gì ở đây. Tuy nhiên, sự thay đổi ở database lại rất lớn:</p> <div class=codehilite><pre><span></span><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=ss>&quot;demo_post&quot;</span> <span class=p>(</span>
    <span class=ss>&quot;id&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>AUTOINCREMENT</span><span class=p>,</span>
    <span class=ss>&quot;title&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;slug&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;created_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;updated_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;publish_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;tags&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;comment_status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;teaser&quot;</span> <span class=nb>text</span> <span class=k>NOT</span> <span class=k>NULL</span>
<span class=p>);</span>
</pre></div> <p>Rất dễ để nhận ra, không hề có bảng <code>demo_contentitembase</code>? Đúng vậy, khi chúng ta sử dụng ABC, Django sẽ làm "phẳng" các mối liên kết giữa các model cha và con và gộp chúng vào thành một bảng trong cơ sở dữ liệu. Điều đó có ý nghĩa gì? Một lợi ích từ việc này chính là, bạn sẽ không cần phải join các bảng với nhau khi phải truy vấn đến cơ sở dữ liệu nữa. Chúng ta xem xét kỹ hơn.</p> <p>Trước hết, lấy một instance <code>Post</code> từ cơ sở dữ liệu:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=n>p</span> <span class=o>=</span> <span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>p</span><span class=o>.</span><span class=n>title</span>
<span class=go>&#39;foobar&#39;</span>
</pre></div> <p>Chúng ta nhận được kết quả giống hệt như ví dụ trước, với cú pháp không khác gì nhau? Sự khác biệt ở đây là thuộc tính <code>title</code> bây giờ là một trường của bảng <code>demo_posts</code> và chúng ta dễ dàng lấy nó ra mà không cần join hay thông qua bất cứ một liên kết nào. Hãy xem câu SQL của truy vấn này:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connection</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>connection</span><span class=o>.</span><span class=n>queries</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<span class=go>{&#39;sql&#39;: &#39;SELECT &quot;demo_post&quot;.&quot;id&quot;, &quot;demo_post&quot;.&quot;title&quot;, &quot;demo_post&quot;.&quot;slug&quot;, &quot;demo_post&quot;.&quot;created_on&quot;, &quot;demo_post&quot;.&quot;updated_on&quot;, &quot;demo_post&quot;.&quot;publish_on&quot;, &quot;demo_post&quot;.&quot;tags&quot;, &quot;demo_post&quot;.&quot;status&quot;, &quot;demo_post&quot;.&quot;comment_status&quot;, &quot;demo_post&quot;.&quot;teaser&quot; FROM &quot;demo_post&quot; WHERE &quot;demo_post&quot;.&quot;id&quot; = 1&#39;, &#39;time&#39;: &#39;0.001&#39;}</span>
</pre></div> <p>Chính xác, không có một câu <code>JOIN</code> nào, có lẽ không phải nói gì nhiều, lợi ích của nó đã quá rõ ràng, đây là một phương án tốt để kế thừa các model.</p> <h1 id=cach-truyen-thong-onetoonefield>Cách truyền thống: <code>OneToOneField</code><a class=headerlink href=#cach-truyen-thong-onetoonefield title="Permanent link">&para;</a></h1> <p>Nội dung bài này chủ yếu nói về hai cách kế thừa model ở trên. Tuy nhiên, tôi sẽ bỏ thêm chút thời gian nữa, để nhìn lại cách làm truyền thống nếu chúng ta không sử dụng hai cách vừa rồi.</p> <p>Với cách "truyền thống", chúng ta có hai phương án để lựa chọn: copy những thuộc tính giống nhau của các model (không DRY cho lắm) và tạo một bảng chứa những thuộc tính chung để tái sử dụng chúng.</p> <p>Ở đây, chúng ta chỉ xem xét phương án thứ 2. Chúng ta sẽ tạo một bảng <code>ContentItemBase</code> và một bảng <code>Post</code> và sẽ liên kết 1:1 giữa hai bảng này. Nghe có vẻ giống MTI nhỉ? Thực ra nghe có vẻ giống nhau nhưng chúng khác nhau hoàn toàn về bản chất. Bởi vì tư tưởng thiết kế này khá giống MTI nên chắc tôi không cần giải thích nhiều, chúng ta đều hiểu cả rồi.</p> <p>Chúng ta sẽ xem xét model <code>ContentItemBase</code>, nó giống hệt như định nghĩa trong ví dụ MTI.</p> <div class=codehilite><pre><span></span><span class=kr>class</span> <span class=nx>ContentItemBase</span><span class=p>(</span><span class=nx>models</span><span class=p>.</span><span class=nx>Model</span><span class=p>)</span><span class=o>:</span>
    <span class=nx>COMMENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=s1>&#39;Open&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Closed&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=nx>DEFAULT_COMMENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;0&#39;</span>
    <span class=nx>CONTENT_STATUS_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;Draft&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=s1>&#39;Public&#39;</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=nx>DEFAULT_CONTENT_STATUS</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>

    <span class=nx>title</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>CharField</span><span class=p>(</span><span class=nx>_</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span> <span class=nx>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
                             <span class=nx>unique_for_date</span><span class=o>=</span><span class=s2>&quot;publish_on&quot;</span><span class=p>)</span>
    <span class=nx>slug</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>SlugField</span><span class=p>(</span><span class=nx>_</span><span class=p>(</span><span class=s1>&#39;slug&#39;</span><span class=p>))</span>
    <span class=nx>created_on</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>DateTimeField</span><span class=p>(</span><span class=nx>_</span><span class=p>(</span><span class=s1>&#39;created on&#39;</span><span class=p>),</span> <span class=nx>auto_now_add</span><span class=o>=</span><span class=nx>True</span><span class=p>,</span>
                                      <span class=nx>editable</span><span class=o>=</span><span class=nx>False</span><span class=p>,</span> <span class=p>)</span>
    <span class=nx>updated_on</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>DateTimeField</span><span class=p>(</span><span class=nx>_</span><span class=p>(</span><span class=s1>&#39;updated on&#39;</span><span class=p>),</span> <span class=nx>editable</span><span class=o>=</span><span class=nx>False</span><span class=p>)</span>
    <span class=nx>publish_on</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>DateTimeField</span><span class=p>(</span><span class=nx>_</span><span class=p>(</span><span class=s1>&#39;publish on&#39;</span><span class=p>),</span> <span class=p>)</span>
    <span class=nx>tags</span> <span class=o>=</span> <span class=nx>TagField</span><span class=p>()</span>
    <span class=nx>status</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>IntegerField</span><span class=p>(</span>
        <span class=nx>_</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>),</span>
        <span class=nx>choices</span><span class=o>=</span><span class=nx>CONTENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=k>default</span><span class=o>=</span><span class=nx>DEFAULT_CONTENT_STATUS</span><span class=p>,</span>
        <span class=nx>db_index</span><span class=o>=</span><span class=nx>True</span>
    <span class=p>)</span>
    <span class=nx>comment_status</span> <span class=o>=</span> <span class=nx>models</span><span class=p>.</span><span class=nx>IntegerField</span><span class=p>(</span>
        <span class=nx>_</span><span class=p>(</span><span class=s1>&#39;comment status&#39;</span><span class=p>),</span>
        <span class=nx>choices</span><span class=o>=</span><span class=nx>COMMENT_STATUS_CHOICES</span><span class=p>,</span>
        <span class=k>default</span><span class=o>=</span><span class=nx>DEFAULT_COMMENT_STATUS</span><span class=p>,</span>
        <span class=nx>db_index</span><span class=o>=</span><span class=nx>True</span>
    <span class=p>)</span>

    <span class=kr>class</span> <span class=nx>Meta</span>:
        <span class=kt>pass</span>
</pre></div> <p>Bây giờ đến model <code>Post</code>, nó sẽ khác biệt tương đối nhiều với ví dụ trước:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Post</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>DEFAULT_INPUT_FORMAT</span> <span class=o>=</span> <span class=s1>&#39;X&#39;</span>
    <span class=n>INPUT_FORMAT_CHOICES</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=s1>&#39;X&#39;</span><span class=p>,</span><span class=s1>&#39;XHTML&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span><span class=s1>&#39;Markdown&#39;</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;R&#39;</span><span class=p>,</span><span class=s1>&#39;Resructured Text&#39;</span><span class=p>),</span>
    <span class=p>)</span>

    <span class=n>contentitembase</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>OneToOneField</span><span class=p>(</span><span class=n>ContentItemBase</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>teaser</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>TextField</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;teaser&#39;</span><span class=p>),</span> <span class=n>blank</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</pre></div> <p>Điều gì xảy ra ở đây? Chúng ta thêm một thuộc tính là <code>contentitembase</code> và định nghĩa nó là <code>OneToOneField</code> liên kết với model <code>ContentItemBase</code>. Vậy điều gì xảy ra ở tầng cơ sở dữ liệu:</p> <div class=codehilite><pre><span></span><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=ss>&quot;demo_contentitembase&quot;</span> <span class=p>(</span>
    <span class=ss>&quot;id&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=n>AUTOINCREMENT</span><span class=p>,</span>
    <span class=ss>&quot;title&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;slug&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;created_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;updated_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;publish_on&quot;</span> <span class=n>datetime</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;tags&quot;</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=ss>&quot;comment_status&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span>
<span class=p>);</span>

<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=ss>&quot;demo_post&quot;</span> <span class=p>(</span>
    <span class=ss>&quot;contentitembase_id&quot;</span> <span class=nb>integer</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=k>REFERENCES</span> <span class=ss>&quot;demo_contentitembase&quot;</span> <span class=p>(</span><span class=ss>&quot;id&quot;</span><span class=p>),</span>
    <span class=ss>&quot;teaser&quot;</span> <span class=nb>text</span> <span class=k>NOT</span> <span class=k>NULL</span>
<span class=p>);</span>
</pre></div> <p>Trông rất giống schema trong ví dụ MTI. Bây giờ, những gì chúng ta có là hai bảng của hai model và liên kết 1:1 giữa chúng thông qua <code>contentitem_id</code> của bảng <code>demo_posts</code>. Và đây mới là sự khác biệt của MTI và cách làm truyền thống này. Hãy xem truy vấn sau:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>connection</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>post</span> <span class=o>=</span> <span class=n>Post</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>pk</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>connection</span><span class=o>.</span><span class=n>queries</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<span class=go>{&#39;sql&#39;: &#39;SELECT &quot;demo_post&quot;.&quot;contentitembase_id&quot;, &quot;demo_post&quot;.&quot;teaser&quot; FROM &quot;demo_post&quot; WHERE &quot;demo_post&quot;.&quot;contentitembase_id&quot; = 1&#39;, &#39;time&#39;: &#39;0.001&#39;}</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>post</span><span class=o>.</span><span class=n>contentitembase</span><span class=o>.</span><span class=n>title</span>
<span class=go>&#39;foobar&#39;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>connection</span><span class=o>.</span><span class=n>queries</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<span class=go>{&#39;sql&#39;: &#39;SELECT &quot;demo_contentitembase&quot;.&quot;id&quot;, &quot;demo_contentitembase&quot;.&quot;title&quot;, &quot;demo_contentitembase&quot;.&quot;slug&quot;, &quot;demo_contentitembase&quot;.&quot;created_on&quot;, &quot;demo_contentitembase&quot;.&quot;updated_on&quot;, &quot;demo_contentitembase&quot;.&quot;publish_on&quot;, &quot;demo_contentitembase&quot;.&quot;tags&quot;, &quot;demo_contentitembase&quot;.&quot;status&quot;, &quot;demo_contentitembase&quot;.&quot;comment_status&quot; FROM &quot;demo_contentitembase&quot; WHERE &quot;demo_contentitembase&quot;.&quot;id&quot; = 1&#39;, &#39;time&#39;: &#39;0.000&#39;}</span>
</pre></div> <p>Đây chính là sự khác biệt. Dòng đầu tiên, chúng ta lấy ra một instance của <code>Post</code>, sử dụng khóa chính (<code>pk</code>). Và trong trường hợp này khóa chính là ID của <code>ContentItemBase</code> chứ không phải ID của <code>Post</code>. Chúng ta đã định nghĩa thuộc tính <code>contentitembase</code> của <code>Post</code> là <code>OneToOneField</code> liên kết với <code>ContentItemBase</code>. Chúng ta cũng định nghĩa trường này là duy nhất, cho phép nó chỉ có thể liên kết 1:1 mà thôi.</p> <p>Một khác biết rõ ràng khác, đó là sử dụng cú pháp như trên, chúng ta lấy được một instance của <code>Post</code> thông qua <code>pk</code> nhưng chúng ta cần thêm một query nữa để lấy các thuộc tính được chia sẻ (như <code>title</code> chẳng hạn). Điều này cần được quan tâm bởi nó ảnh hưởng không nhỏ đến hiệu năng của hệ thống.</p> <h1 id=ket-luan>Kết luận<a class=headerlink href=#ket-luan title="Permanent link">&para;</a></h1> <p>Bài viết này đã xem xét qua các cách làm để kế thừa các model đó là Multiple Table Inheritance (composition) và Abstract Base Classes (inheritance). Tôi nghĩ rằng, Django đã xây dựng cho chúng ta những công cụ rất tuyệt vời. Phương án nào tốt hơn phương án nào? Tôi sẽ dành việc trả lời câu hỏi này cho các bạn, khi các bạn cần phải giải quyết những bài toán của riêng mình.</p> </div> <div class=post-footer> <div class=tags> <i class="fa fa-tags"></i> <span>#Django</span> <span>#Python</span> <span>#Inheritance</span> <span>#Multi-table</span> <span>#Abstract</span> </div> </div> </div><div class=blog-pager> <span class=newer-link> <a href=/2016/Feb/05/system-programming-references.html> Newer Post </a> </span> <span class=older-link> <a href=/2016/Jan/24/how-to-use-django-admin-and-when-should-not-use-it.html> Older Post </a> </span> </div><div class=comments> <div class=finally> <p><em>I apologise for any typos. If you notice a problem, please let me know.</em> <p>Thank you all for your attention. </div> <div id=disqus_thread></div> <script src=/theme/js/disqus.min.js?81e8a5f5></script> <noscript> Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript> comments powered by Disqus. </a> </noscript> </div></div> </div> </div> <div class=sidebar-wrapper> <div class=widget> <h2>Welcome</h2> <div> <img src=/theme/images/banner.gif alt=Welcome> </div> </div><div class="widget recent-posts"> <h2>Recent Posts</h2> <ul> <li> <a href=/2019/May/20/elasticsearch-data-organization.html> <img alt="Elasticsearch: Data organization" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-data-organization.html>Elasticsearch: Data organization</a> <li> <a href=/2019/May/20/elasticsearch-intro.html> <img alt="Elasticsearch: Intro" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-intro.html>Elasticsearch: Intro</a> <li> <a href=/2019/Apr/20/javascript-popups.html> <img alt="JavaScript: Popups" src=https://i.imgur.com/FxmcwPy.png> </a> <a href=/2019/Apr/20/javascript-popups.html>JavaScript: Popups</a> <li> <a href=/2019/Mar/20/javascript-iterator-and-generator.html> <img alt="JavaScript: Iterator and generator" src=https://i.imgur.com/lev8iT9.jpg> </a> <a href=/2019/Mar/20/javascript-iterator-and-generator.html>JavaScript: Iterator and generator</a> <li> <a href=/2019/Feb/20/javascript-decorator.html> <img alt="JavaScript decorator" src=https://i.imgur.com/Sh3yLI0.png> </a> <a href=/2019/Feb/20/javascript-decorator.html>JavaScript decorator</a> </ul> </div><div class="widget labels"> <h2>Blog Archive</h2> <ul> <li> <a href=/2019/ > 2019 </a> <li> <a href=/2018/ > 2018 </a> <li> <a href=/2017/ > 2017 </a> <li> <a href=/2016/ > 2016 </a> <li> <a href=/2015/ > 2015 </a> <li> <a href=/2014/ > 2014 </a> <li> <a href=/2013/ > 2013 </a> <li> <a href=/2012/ > 2012 </a> <li> <a href=/2011/ > 2011 </a> <li> <a href=/2010/ > 2010 </a> </ul> </div><div class=widget> <h2>Twitter timeline</h2> <a class=twitter-timeline data-height=500 data-dnt=true data-theme=light href=https://twitter.com/_naa_4f data-chrome="noheader nofooter transparent noborders"> Tweets by manhhomienbienthuy </a> </div> </div> </div> <a href=# class="smooth-scroll back-to-top"> <i class="fa fa-arrow-circle-up fa-3x"></i> </a> </main> <footer> <div class=infos> <div class=wrapper> <div class=widget> <a href=/ title="manhhomienbienthuy's space" class=logo> <img alt="manhhomienbienthuy's space" src=/theme/images/logo_white.png> </a> <span class=right>I'm a hacker, enter my world...</span> </div><div class=widget> <p> Created with all my ♥ and soul, dedicated to my love, yunachan <p> Powered by <a href=http://blog.getpelican.com/ target=_blank>Pelican</a>, which takes great advantage of <a href=https://www.python.org/ target=_blank>Python</a> <p> This site content is licensed under a <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank> CC BY-NC-ND 4.0 </a> License. <p> Updated at <a target=_blank href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=2019-06-20T02:42:55"> 2019-06-20 02:42:55 </a> </div><div class=widget> <p> Hosting by <a href=https://manhhomienbienthuy.bitbucket.io/ >Bitbucket</a> and <a href=https://manhhomienbienthuy.github.io/ >Github</a>, image hosting by <a href=https://manhhomienbienthuy.imgur.com/ target=_blank>imgur</a>, <a href=https://instagram.com/manhhomienbienthuy/ target=_blank>Instagram</a> and <a href=https://photos.google.com/ target=_blank>Google Photo</a> <p> Theme based on <a href=https://vanice-veethemes.blogspot.com/ target=_blank>Vanice theme</a>, icons from <a href=https://fontawesome.com/ target=_blank>Font Awesome</a>, comments powered by <a href=https://disqus.com/home/forums/manhhomienbienthuy/ target=_blank>Disqus</a> </div> </div> </div> <div class=credits> <div class=wrapper> <div class=left> <!--
          Regarding copyright, in general, standalone pages (as
          opposed to files generated as part of manuals) on the GNU
          web server should be under CC BY-ND 4.0.  Please do NOT
          change or remove this without talking with the webmasters or
          licensing team first.  Please make sure the copyright date
          is consistent with the document.  For web pages, it is ok to
          list just the latest year the document was modified, or
          published.

          If you wish to list earlier years, that is ok too.  Either
          "2001, 2002, 2003" or "2001-2003" are ok for specifying
          years, as long as each year in the range is in fact a
          copyrightable year, i.e., a year in which the document was
          published (including being publicly visible on the web or in
          a revision control system).
        --> Copyright © 2010-2019 <a href=/pages/about-me.html><strong>manhhomienbienthuy</strong></a>. All rights reserved. </div> <div class=right> <ul> <li><a href=/ >Home</a> <li><a href=/pages/about-me.html>About</a> <li><a href=# class=smooth-scroll>Top ↑</a> </ul> </div> </div> </div></footer> <script src=https://code.jquery.com/jquery-3.2.1.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js></script> <script src=/theme/js/vpyeu.min.js?d72c87bd></script> <script id=dsq-count-scr src=https://manhhomienbienthuy.disqus.com/count.js async></script>