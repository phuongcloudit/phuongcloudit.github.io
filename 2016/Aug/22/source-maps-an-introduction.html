<!DOCTYPE html><title>Source Maps: An introduction - manhhomienbienthuy's space</title> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=apple-touch-icon href=/theme/images/icon-touch.png> <link rel=icon sizes=192x192 href=/theme/images/icon-touch.png> <link rel="shortcut icon" href=/theme/images/favicon.ico> <link rel=author href=/humans.txt> <meta name=msapplication-TileImage content=/theme/images/icon-tile.png> <meta name=twitter:dnt content=on> <meta name=Author content=manhhomienbienthuy> <meta name=rating content=general> <meta name=twitter:card content=product> <meta name=twitter:site content=@_naa_4f> <meta name=twitter:creator content=@_naa_4f> <link href=/feeds/all.atom.xml type=application/atom+xml rel=alternate title="manhhomienbienthuy's space Full Atom Feed"> <meta name=description content="Trong quá trình phát triển Web, với các công việc liên quan đến front-end, ví dụ như code CSS, JS, có thể bạn sẽ dùng đến một số preprocessor như SASS, CoffeeScript,... cũng như các công cụ để gộp và nén file. Nhưng khi bạn muốn debug code của những …"> <meta name=keywords content="CSS, JavaScript, code, source maps, blog, naa, manhhomienbienthuy, pelican, static site generator"> <meta name=twitter:title content="Source Maps: An introduction - manhhomienbienthuy's space"> <meta name=twitter:description content="Trong quá trình phát triển Web, với các công việc liên quan đến front-end, ví dụ như code CSS, JS, có thể bạn sẽ dùng đến một số preprocessor như SASS, CoffeeScript,... cũng như các công cụ để gộp và nén file. Nhưng khi bạn muốn debug code của những …"> <meta name=twitter:image content=/https://i.imgur.com/25YTuIG.png> <link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css> <link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css> <link rel=stylesheet href=/theme/css/vpyeu.min.css?5d2c7d5e> <header> <div class=navbar> <div class=wrapper> <div class=nav-menu> <div class=menu-toggle> <i class="fa fa-reorder"></i> </div> <ul class=menus> <li><a href=/ >Home</a> <li><a href=/category/general.html> General <li><a href=/category/life.html> Life <li><a href=/category/programming.html class=current> Programming <li><a href=/category/travel.html> Travel </ul> </div><div class="right links"> <ul> <li> <a href=https://twitter.com/_naa_4f target=_blank> <i class="fa fa-twitter"></i> </a> <li> <a href=https://instagram.com/manhhomienbienthuy/ target=_blank> <i class="fa fa-instagram"></i> </a> <li> <a href=https://www.facebook.com/manhhomienbienthuy target=_blank> <i class="fa fa-facebook"></i> </a> <li> <a href=https://github.com/manhhomienbienthuy target=_blank> <i class="fa fa-github"></i> </a> <li> <a href=/feeds/all.atom.xml target=_blank> <i class="fa fa-rss"></i> </a> </ul> </div> </div> </div><noscript> <div class="warning head-warn"> <div class=wrapper> <p><strong>Notice:</strong> While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </div> </div> </noscript><div class=banner> <div class=wrapper> <a href=/ > <img alt="manhhomienbienthuy's space" src=/theme/images/logo.png> </a> </div> </div></header> <main> <div class=wrapper> <div class=main-wrapper> <div class=entry> <div class=entry-detail> <div class=post> <h1 class=title> Source Maps: An introduction </h1> <div class=meta> Posted in <a href=/category/programming.html>Programming</a> on August 22, 2016 by <a href=/pages/about-me.html>manhhomienbienthuy</a> <span class=right> <i class="fa fa-comments"></i> <a href=#disqus_thread data-disqus-identifier=/2016/Aug/22/source-maps-an-introduction.html> Comments </a> </span> </div> <div class=post-body> <img src=https://i.imgur.com/25YTuIG.png alt="Source Maps: An introduction"> <p>Trong quá trình phát triển Web, với các công việc liên quan đến front-end, ví dụ như code CSS, JS, có thể bạn sẽ dùng đến một số preprocessor như SASS, CoffeeScript,... cũng như các công cụ để gộp và nén file. Nhưng khi bạn muốn debug code của những file kết quả đã được biên dịch đó, bạn sẽ phải làm thế nào đây? Nó có thể sẽ là một thảm họa nếu không có sự giúp đỡ của source map.</p> <p>Source map cung cấp cho chúng ta một ánh xạ của code đã biên dịch với mã nguồn ban đầu của nó. Có nghĩa là, với source map (cùng sự giúp đỡ của các công cụ hỗ trợ), chúng ta sẽ dễ dàng debug ứng dụng ngay cả khi CSS, JS của nó đã được biên dịch và tối ưu hóa. Hiện nay, phần lớn các trình duyệt hiện đại như Chrome và Firefox đều tích hợp sẵn công cụ để làm việc với source map.</p> <p>Trong bài viết này, chúng ta sẽ tìm hiểu cách thức làm việc của source map và cách để thêm chúng vào dự án của chúng ta. Trong nội dung bài viết này, tôi sẽ tập trung vào source map cho CSS, source map cho JavaScript cũng tương tự như vậy.</p> <h1 id=source-maps-giup-chung-ta-nhu-the-nao>Source maps giúp chúng ta như thế nào?<a class=headerlink href=#source-maps-giup-chung-ta-nhu-the-nao title="Permanent link">&para;</a></h1> <p>Giả sử bạn dùng SASS (SCSS) cho dự án của mình, và dùng các công cụ tương ứng để biên dịch và tối ưu hóa code CSS. Bạn có một file chính và file này import các file khác. Kết quả sau khi biên dịch bạn có một file css và đương nhiên là nó hoạt động tốt. Nhưng nếu bạn kiểm tra các phần tử HTML để xem code CSS nào được áp dụng cho phần tử đó thì bạn sẽ thu được kết quả như dưới đây:</p> <p><img alt="inspect without source map" src=https://i.imgur.com/6JipPBp.png></p> <p>Như bạn thấy đó, tất cả CSS được áp dụng cho phần tử hiện tại đều được chỉ ra là đến từ một file duy nhất (<code>vpyeu.css</code>), đây là file sau khi biên dịch rồi. Và với thông tin như vậy, bạn không thể nào biết được, code SCSS tương ứng là ở đâu và nếu cần sửa thì việc tìm ra vị trí mã nguồn để sửa cũng là một công việc chẳng dễ dàng gì.</p> <p>Tuy nhiên, nếu thêm source map vào trong quá trình biên dịch, chúng ta sẽ có thêm một số thông tin mà khi kiểm tra phần tử sẽ được như thế này:</p> <p><img alt="inspect with source map" src=https://i.imgur.com/7m7slN9.png></p> <p>Việc debug đã dễ hơn rất nhiều, chúng ta thấy được rằng, một số CSS áp dụng cho phần tử hiện tại đến từ file <code>_countdown.scss</code> trong khi một số khác đến từ <code>_basics.scss</code>. Thậm chí, chúng ta còn có thể xem cả mã nguồn SCSS của chính những file này:</p> <p><img alt="source file content" src=https://i.imgur.com/fWdGolg.png></p> <p>Vậy đó, rõ ràng source map đã giúp công việc debug của chúng ta trở nên rất dễ dàng và nhàn hạ.</p> <h1 id=source-maps-lam-viec-nhu-the-nao>Source maps làm việc như thế nào?<a class=headerlink href=#source-maps-lam-viec-nhu-the-nao title="Permanent link">&para;</a></h1> <p>Như tên của chính nó, source map có chứa một số thông tin dùng để ánh xạ code đã biên dịch và mã nguồn gốc của nó. Bạn có thể chỉ định source map cho từng file. Bạn có thể chỉ cho trình duyệt biết source map của một file ở đâu bằng cách thêm một comment đặc biệt như sau vào cuối file:</p> <div class=codehilite><pre><span></span><span class=c>/*# sourceMappingURL=vpyeu.css.map */</span>
</pre></div> <p>Thông thường, các công cụ hỗ trợ tạo source map sẽ giúp chúng ta thêm comment như trên. Các trình duyệt với công cụ hỗ trợ source map được tích hợp sẵn sẽ load dữ liệu từ file source map tương ứng và hiển thị kết quả giúp chúng ta.</p> <p>Ngoài ra, bạn cũng có thể chỉ source map bằng cách sử dụng HTTP header <code>X-SourceMap</code> trong kết quả trả về khi request các file:</p> <div class=codehilite><pre><span></span>X-SourceMap: /path/to/vpyeu.css.map
</pre></div> <p>File source map thực ra một file JSON có chứa một vài metadata về chính file source map đó và các dữ liệu để ánh xạ code biên dịch với mã nguồn của nó. Dưới đây là một ví dụ về file source map:</p> <div class=codehilite><pre><span></span><span class=p>{</span>
    <span class=nt>&quot;version&quot;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
    <span class=nt>&quot;sources&quot;</span><span class=p>:</span> <span class=p>[</span>
      <span class=s2>&quot;vpyeu.scss&quot;</span><span class=p>,</span>
      <span class=s2>&quot;_normalize.scss&quot;</span><span class=p>,</span>
      <span class=s2>&quot;vpyeu.css&quot;</span><span class=p>,</span>
      <span class=s2>&quot;_basics.scss&quot;</span><span class=p>,</span>
      <span class=s2>&quot;_countdown.scss&quot;</span><span class=p>,</span>
      <span class=s2>&quot;_others.scss&quot;</span><span class=p>,</span>
    <span class=p>],</span>
    <span class=nt>&quot;names&quot;</span><span class=p>:</span> <span class=p>[],</span>
    <span class=nt>&quot;mappings&quot;</span><span class=p>:</span> <span class=s2>&quot;AAAA;;;;;;GAMG;ACFH;EACI,wBAAwB;EACxB,2BAA2B;...&quot;</span><span class=p>,</span>
    <span class=nt>&quot;file&quot;</span><span class=p>:</span> <span class=s2>&quot;vpyeu.css&quot;</span><span class=p>,</span>
    <span class=nt>&quot;sourcesContent&quot;</span><span class=p>:[</span><span class=s2>&quot;// normalize.css v4.0.0 |...&quot;</span><span class=p>],</span>
    <span class=nt>&quot;sourceRoot&quot;</span><span class=p>:</span> <span class=s2>&quot;/source/&quot;</span>
<span class=p>}</span>
</pre></div> <p>Source map sẽ có một số thông tin như sau:</p> <ul> <li><code>version</code>: đây là thông tin về phiên bản dùng để định dạng file source map</li> <li><code>sources</code>: một danh sách các URL của các file mã nguồn</li> <li><code>names</code>: một danh sách các biến và tên hàm trong mã nguồn</li> <li><code>mappings</code>: xâu đã mã hóa Base64 <a href=https://en.wikipedia.org/wiki/Variable-length_quantity>VLQ</a>. Đây chính là dữ liệu dùng để ánh xạ code đã biên dịch với mã nguồn của nó. Và đây cũng chính là nơi mà mọi điều kỳ diệu bắt đầu.</li> <li><code>file</code>: tên của file source map</li> <li><code>sourceRoot</code> (có thể có hoặc không) chứa thông tin về nơi lưu trữ các file <code>sources</code></li> <li><code>sourceContent</code> (có thể có hoặc không) lưu trữ mã nguồn của chính các file gốc. Đây là nội dung rất cần thiết khi chúng ta không upload các file mã nguồn (do đó trình duyệt không thể load được)</li> </ul> <p>Để hiểu rõ hơn về đặc tả kỹ thuật của source map, bạn có thể tham khảo thêm <a href=https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit>tài liệu này</a></p> <h1 id=them-source-map-cho-du-an>Thêm source map cho dự án<a class=headerlink href=#them-source-map-cho-du-an title="Permanent link">&para;</a></h1> <p>Nếu bạn sử dụng grunt, thì các task dùng để biên dịch SASS như <code>grunt-contrib-sass</code> đã tích hợp sẵn công cụ tạo source map, bạn chỉ cần cấu hình nó cho phù hợp với nhu cầu là đủ:</p> <div class=codehilite><pre><span></span><span class=nx>sass</span><span class=o>:</span> <span class=p>{</span>
    <span class=nx>dist</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
            <span class=nx>sourcemap</span><span class=o>:</span> <span class=s1>&#39;inline&#39;</span>
        <span class=p>},</span>
        <span class=nx>files</span><span class=o>:</span> <span class=p>{</span>
            <span class=s1>&#39;vpyeu.css&#39;</span><span class=o>:</span> <span class=s1>&#39;vpyeu.scss&#39;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>Tương tự, các công cụ tối ưu hóa JavaScript cũng tích hợp sẵn công cụ tạo source map. Ví dụ với <code>grunt-contrib-uglify</code>:</p> <div class=codehilite><pre><span></span><span class=nx>uglify</span><span class=o>:</span> <span class=p>{</span>
    <span class=nx>dist</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
            <span class=nx>sourceMap</span><span class=o>:</span> <span class=kc>true</span>
        <span class=p>},</span>
        <span class=nx>files</span><span class=o>:</span> <span class=p>{</span>
            <span class=s1>&#39;dest/output.min.js&#39;</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;src/input.js&#39;</span><span class=p>],</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>Nếu bạn sử dụng gulp, công cụ biên dịch SCSS chưa tích hợp công cụ tạo source map, nên bạn cần thêm <code>gulp-sourcemap</code> để sử dụng:</p> <div class=codehilite><pre><span></span><span class=kd>var</span> <span class=nx>sourcemaps</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;gulp-sourcemaps&#39;</span><span class=p>);</span>

<span class=nx>gulp</span><span class=p>.</span><span class=nx>task</span><span class=p>(</span><span class=s1>&#39;stylesheet&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>gulp</span>
        <span class=p>.</span><span class=nx>src</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>src</span><span class=p>.</span><span class=nx>css</span><span class=p>)</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>sourcemaps</span><span class=p>.</span><span class=nx>init</span><span class=p>())</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>sass</span><span class=p>())</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>autoprefixer</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>autoprefixer</span><span class=p>))</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>cssmin</span><span class=p>())</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>sourcemaps</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>))</span>
        <span class=p>.</span><span class=nx>pipe</span><span class=p>(</span><span class=nx>gulp</span><span class=p>.</span><span class=nx>dest</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>dest</span><span class=p>.</span><span class=nx>css</span><span class=p>));</span>
<span class=p>});</span>
</pre></div> <p>Một vài lưu ý rằng, có những công cụ để tối ưu hóa code CSS như <code>gulp-shorthand</code>, <code>gulp-combine-mq</code> không tương thích với source map và sẽ phá vỡ ánh xạ mà source map cung cấp.</p> <h1 id=ket-luan>Kết luận<a class=headerlink href=#ket-luan title="Permanent link">&para;</a></h1> <p>Sử dụng source map cho phép các nhà phát triển dễ dàng debug và maintain ứng dụng trong khi vẫn có thể tối ưu hóa code CSS, JS để nâng cao hiệu suất của trang Web. Trong bài viết này, chúng ta đã tìm hiểu cách source map làm việc và lợi ích của nó, cũng như cách thêm source map vào dự án. Thực sự, việc tích hợp source map vào dự án là một việc không mất nhiều thời gian nhưng rất có giá trị.</p> </div> <div class=post-footer> <div class=tags> <i class="fa fa-tags"></i> <span>#CSS</span> <span>#JavaScript</span> <span>#code</span> <span>#source maps</span> </div> </div> </div><div class=blog-pager> <span class=newer-link> <a href=/2016/Nov/23/common-website-vulnerabilities-and-how-to-protect-in-django.html> Newer Post </a> </span> <span class=older-link> <a href=/2016/Jul/14/keep-gulp-running-with-gulp-plumber.html> Older Post </a> </span> </div><div class=comments> <div class=finally> <p><em>I apologise for any typos. If you notice a problem, please let me know.</em> <p>Thank you all for your attention. </div> <div id=disqus_thread></div> <script src=/theme/js/disqus.min.js?81e8a5f5></script> <noscript> Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript> comments powered by Disqus. </a> </noscript> </div></div> </div> </div> <div class=sidebar-wrapper> <div class=widget> <h2>Welcome</h2> <div> <img src=/theme/images/banner.gif alt=Welcome> </div> </div><div class="widget recent-posts"> <h2>Recent Posts</h2> <ul> <li> <a href=/2019/May/20/elasticsearch-data-organization.html> <img alt="Elasticsearch: Data organization" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-data-organization.html>Elasticsearch: Data organization</a> <li> <a href=/2019/May/20/elasticsearch-intro.html> <img alt="Elasticsearch: Intro" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-intro.html>Elasticsearch: Intro</a> <li> <a href=/2019/Apr/20/javascript-popups.html> <img alt="JavaScript: Popups" src=https://i.imgur.com/FxmcwPy.png> </a> <a href=/2019/Apr/20/javascript-popups.html>JavaScript: Popups</a> <li> <a href=/2019/Mar/20/javascript-iterator-and-generator.html> <img alt="JavaScript: Iterator and generator" src=https://i.imgur.com/lev8iT9.jpg> </a> <a href=/2019/Mar/20/javascript-iterator-and-generator.html>JavaScript: Iterator and generator</a> <li> <a href=/2019/Feb/20/javascript-decorator.html> <img alt="JavaScript decorator" src=https://i.imgur.com/Sh3yLI0.png> </a> <a href=/2019/Feb/20/javascript-decorator.html>JavaScript decorator</a> </ul> </div><div class="widget labels"> <h2>Blog Archive</h2> <ul> <li> <a href=/2019/ > 2019 </a> <li> <a href=/2018/ > 2018 </a> <li> <a href=/2017/ > 2017 </a> <li> <a href=/2016/ > 2016 </a> <li> <a href=/2015/ > 2015 </a> <li> <a href=/2014/ > 2014 </a> <li> <a href=/2013/ > 2013 </a> <li> <a href=/2012/ > 2012 </a> <li> <a href=/2011/ > 2011 </a> <li> <a href=/2010/ > 2010 </a> </ul> </div><div class=widget> <h2>Twitter timeline</h2> <a class=twitter-timeline data-height=500 data-dnt=true data-theme=light href=https://twitter.com/_naa_4f data-chrome="noheader nofooter transparent noborders"> Tweets by manhhomienbienthuy </a> </div> </div> </div> <a href=# class="smooth-scroll back-to-top"> <i class="fa fa-arrow-circle-up fa-3x"></i> </a> </main> <footer> <div class=infos> <div class=wrapper> <div class=widget> <a href=/ title="manhhomienbienthuy's space" class=logo> <img alt="manhhomienbienthuy's space" src=/theme/images/logo_white.png> </a> <span class=right>I'm a hacker, enter my world...</span> </div><div class=widget> <p> Created with all my ♥ and soul, dedicated to my love, yunachan <p> Powered by <a href=http://blog.getpelican.com/ target=_blank>Pelican</a>, which takes great advantage of <a href=https://www.python.org/ target=_blank>Python</a> <p> This site content is licensed under a <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank> CC BY-NC-ND 4.0 </a> License. <p> Updated at <a target=_blank href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=2019-06-20T02:42:55"> 2019-06-20 02:42:55 </a> </div><div class=widget> <p> Hosting by <a href=https://manhhomienbienthuy.bitbucket.io/ >Bitbucket</a> and <a href=https://manhhomienbienthuy.github.io/ >Github</a>, image hosting by <a href=https://manhhomienbienthuy.imgur.com/ target=_blank>imgur</a>, <a href=https://instagram.com/manhhomienbienthuy/ target=_blank>Instagram</a> and <a href=https://photos.google.com/ target=_blank>Google Photo</a> <p> Theme based on <a href=https://vanice-veethemes.blogspot.com/ target=_blank>Vanice theme</a>, icons from <a href=https://fontawesome.com/ target=_blank>Font Awesome</a>, comments powered by <a href=https://disqus.com/home/forums/manhhomienbienthuy/ target=_blank>Disqus</a> </div> </div> </div> <div class=credits> <div class=wrapper> <div class=left> <!--
          Regarding copyright, in general, standalone pages (as
          opposed to files generated as part of manuals) on the GNU
          web server should be under CC BY-ND 4.0.  Please do NOT
          change or remove this without talking with the webmasters or
          licensing team first.  Please make sure the copyright date
          is consistent with the document.  For web pages, it is ok to
          list just the latest year the document was modified, or
          published.

          If you wish to list earlier years, that is ok too.  Either
          "2001, 2002, 2003" or "2001-2003" are ok for specifying
          years, as long as each year in the range is in fact a
          copyrightable year, i.e., a year in which the document was
          published (including being publicly visible on the web or in
          a revision control system).
        --> Copyright © 2010-2019 <a href=/pages/about-me.html><strong>manhhomienbienthuy</strong></a>. All rights reserved. </div> <div class=right> <ul> <li><a href=/ >Home</a> <li><a href=/pages/about-me.html>About</a> <li><a href=# class=smooth-scroll>Top ↑</a> </ul> </div> </div> </div></footer> <script src=https://code.jquery.com/jquery-3.2.1.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js></script> <script src=/theme/js/vpyeu.min.js?d72c87bd></script> <script id=dsq-count-scr src=https://manhhomienbienthuy.disqus.com/count.js async></script>