<!DOCTYPE html><title>Hash length Extension Attacks - manhhomienbienthuy's space</title> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=apple-touch-icon href=/theme/images/icon-touch.png> <link rel=icon sizes=192x192 href=/theme/images/icon-touch.png> <link rel="shortcut icon" href=/theme/images/favicon.ico> <link rel=author href=/humans.txt> <meta name=msapplication-TileImage content=/theme/images/icon-tile.png> <meta name=twitter:dnt content=on> <meta name=Author content=manhhomienbienthuy> <meta name=rating content=general> <meta name=twitter:card content=product> <meta name=twitter:site content=@_naa_4f> <meta name=twitter:creator content=@_naa_4f> <link href=/feeds/all.atom.xml type=application/atom+xml rel=alternate title="manhhomienbienthuy's space Full Atom Feed"> <meta name=description content="Hash length extension attack - tấn công mở rộng độ dài hash là một kỹ thuật tấn công vào kỹ thuật MAC (Message Authenticate Code). Đây là kỹ thuật tấn công khai thác lỗ hổng của các thuật toán mã hoá một chiều (hash). Sử dụng cách tấn công này, những …"> <meta name=keywords content="Hash, Security, Attack, Crack, blog, naa, manhhomienbienthuy, pelican, static site generator"> <meta name=twitter:title content="Hash length Extension Attacks - manhhomienbienthuy's space"> <meta name=twitter:description content="Hash length extension attack - tấn công mở rộng độ dài hash là một kỹ thuật tấn công vào kỹ thuật MAC (Message Authenticate Code). Đây là kỹ thuật tấn công khai thác lỗ hổng của các thuật toán mã hoá một chiều (hash). Sử dụng cách tấn công này, những …"> <meta name=twitter:image content=/https://i.imgur.com/mYU6zqI.jpg> <link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css> <link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css> <link rel=stylesheet href=/theme/css/vpyeu.min.css?5d2c7d5e> <header> <div class=navbar> <div class=wrapper> <div class=nav-menu> <div class=menu-toggle> <i class="fa fa-reorder"></i> </div> <ul class=menus> <li><a href=/ >Home</a> <li><a href=/category/general.html class=current> General <li><a href=/category/life.html> Life <li><a href=/category/programming.html> Programming <li><a href=/category/travel.html> Travel </ul> </div><div class="right links"> <ul> <li> <a href=https://twitter.com/_naa_4f target=_blank> <i class="fa fa-twitter"></i> </a> <li> <a href=https://instagram.com/manhhomienbienthuy/ target=_blank> <i class="fa fa-instagram"></i> </a> <li> <a href=https://www.facebook.com/manhhomienbienthuy target=_blank> <i class="fa fa-facebook"></i> </a> <li> <a href=https://github.com/manhhomienbienthuy target=_blank> <i class="fa fa-github"></i> </a> <li> <a href=/feeds/all.atom.xml target=_blank> <i class="fa fa-rss"></i> </a> </ul> </div> </div> </div><noscript> <div class="warning head-warn"> <div class=wrapper> <p><strong>Notice:</strong> While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </div> </div> </noscript><div class=banner> <div class=wrapper> <a href=/ > <img alt="manhhomienbienthuy's space" src=/theme/images/logo.png> </a> </div> </div></header> <main> <div class=wrapper> <div class=main-wrapper> <div class=entry> <div class=entry-detail> <div class=post> <h1 class=title> Hash length Extension Attacks </h1> <div class=meta> Posted in <a href=/category/general.html>General</a> on September 30, 2015 by <a href=/pages/about-me.html>manhhomienbienthuy</a> <span class=right> <i class="fa fa-comments"></i> <a href=#disqus_thread data-disqus-identifier=/2015/Sep/30/hash-length-extension-attacks.html> Comments </a> </span> </div> <div class=post-body> <img src=https://i.imgur.com/mYU6zqI.jpg alt="Hash length Extension Attacks"> <p>Hash length extension attack - tấn công mở rộng độ dài hash là một kỹ thuật tấn công vào kỹ thuật MAC (Message Authenticate Code). Đây là kỹ thuật tấn công khai thác lỗ hổng của các thuật toán mã hoá một chiều (hash). Sử dụng cách tấn công này, những kẻ tấn công có thể xâm nhập vào hệ thống mà chỉ cần dựa vào những thông tin public của hệ thống.</p> <h1 id=tldr>TL;DR<a class=headerlink href=#tldr title="Permanent link">&para;</a></h1> <p>Cho một hash được tạo thành từ 1 string ghép với phần prefix không biết trước, kẻ tấn công có thể viết thêm vào đoạn string đó và tạo ra một hash mới mà không cần biết đoạn prefix đó.</p> <h1 id=boi-canh>Bối cảnh<a class=headerlink href=#boi-canh title="Permanent link">&para;</a></h1> <p>Khi bạn viết một trang Web, có một số dữ liệu bạn cần lưu nó vào cookie của người dùng. Để đảm bảo lần tiếp theo truy cập trang, người dùng gửi lên đúng dữ liệu mà bạn đã set chứ không phải dữ liệu giả mạo, bạn set thêm vào cookie một signature. Signature đó được tính bằng <code>signature = hash(salt||data)</code>. Cả <code>data</code> và <code>signature</code> đều được set vào cookie của người dùng. Dữ liệu <code>salt</code> bạn giữ bí mật trên server không cho người dùng biết. Khi người dùng gửi dữ liệu lên, bạn kiểm tra xem <code>hash(salt||data) == signature</code> hay không để thực hiện các xử lý tiếp theo. Nếu so sánh trên đúng, có nghĩa là người dùng đã gửi thông tin chính xác, nếu sai có nghĩa là người dùng đã gửi thông tin giả mạo. Cách làm này được cho là an toàn và bảo mật vì những lý do sau:</p> <ul> <li>Bạn giữ dữ liệu <code>salt</code> một cách bí mật trên server và người dùng không thể biết được.</li> <li>Các thuật toán hash, ví dụ MD5, SHA1, v.v... đều là one-way hash, tức là chúng chỉ mã hoá một chiều mà không thể giải mã. Và cho dù người dùng có biết được <code>signature</code> và <code>data</code> cũng không thể tìm cách crack để tìm ra <code>salt</code> được.</li> <li>Hiện nay có một số tool crack thuật toán MD5 kinh điển, nhưng chúng đều dựa trên cơ sở dữ liệu khủng chứ chưa có một cách crack nào. Tất cả các tool này đều có thể phòng chống bằng cách sử dụng <code>salt</code> dài.</li> </ul> <p>Tuy nhiên, trong bài viết này, tôi sẽ giới thiệu một kỹ thuật có thể crack được kỹ thuật MAC như trên.</p> <p>Trước hết, để hiểu cách tấn công này, bạn cần hiểu được thuật toán hash.</p> <h1 id=cach-thuc-ma-hoa-hash>Cách thức mã hoá hash<a class=headerlink href=#cach-thuc-ma-hoa-hash title="Permanent link">&para;</a></h1> <p>Ở đây, tôi sẽ giới thiệu cách mã hoá sử dụng thuật toán SHA-1, các thuật toán khác tương tự như vậy.</p> <p>SHA-1 xử lý dữ liệu thành từng khối 64 byte (512 bit). Với những dữ liệu có độ dài khác nhau, SHA-1 sẽ chèn thêm một số lượng các bit, phần lớn là bit <code>0</code> (ít nhất là 65 bit và nhiều nhất là 576 bit) để độ dài dữ liệu là bội số của 512. Số bit được thêm vào này gọi là padding. Các bit padding này chỉ phụ thuộc vào độ dài ban đầu của dữ liệu, nó hoàn toàn không phụ thuộc gì vào nội dung dữ liệu này.</p> <p>Sau đó dữ liệu đã được thêm các bit padding này được chia thành các block 512 bit và được xử lý từng block một. SHA-1 có một hàm nén và một running state là một cụm 5 từ có độ dài 32 bit. Bạn hoàn toàn có thể tìm hiểu cách hoạt động của SHA-1 ở <a href=https://en.wikipedia.org/wiki/SHA-1>đây</a>. Cách mã hoá này có thể tóm lược như sau:</p> <p>Hàm nén nhận đầu vào là 2 giá trị có độ dài lần lượt là 160 và 512 bit, và trả về kết quả là chuỗi 160 bit. Quá trình xử lý giống như dưới đây:</p> <ul> <li>Running state được khởi tạo hoàn toàn giống nhau cho các dữ liệu khác nhau. Các giá trị này được đưa ra bởi đặc tả của SHA-1.</li> <li>Với mỗi block, hàm nén sẽ được thực thi với đầu vào là running state hiện tại, và một đầu vào khác là block cần xử lý. Đầu ra của hàm nén này sẽ là running state mới.</li> <li>Running state sau khi xử lý block cuối cùng chính là kết quả hash cần tính.</li> </ul> <h1 id=nguyen-ly-tan-cong-mo-rong-o-dai-hash>Nguyên lý tấn công mở rộng độ dài hash<a class=headerlink href=#nguyen-ly-tan-cong-mo-rong-o-dai-hash title="Permanent link">&para;</a></h1> <p>Bây giờ tôi sẽ nói đến kỹ thuật tấn công. Giả sử tôi được đưa cho một giá trị hash <code>h</code> được tính từ giá trị của <code>m</code>. Tôi không biết <code>m</code> nhưng tôi biết độ dài của nó.</p> <p>Bởi vì tôi biết độ dài của <code>m</code>, tôi có thể dễ dàng tính được các bit padding <code>p</code> được sử dụng. Sau đó, tôi cần một giá trị <code>m'</code> là giá trị mới bắt đầu bằng <code>m||p</code> và tôi sẽ chèn thêm dữ liệu giả mạo của mình, <code>m' = m||p||z</code>, với <code>z</code> là giá trị tôi cần thêm vào. Bây giờ tôi cần tính giá trị hash SHA-1 <code>h'</code> với đầu vào mới là <code>m'</code> mặc dù tôi không hề biết nội dung đầy đủ của nó. (Do tôi không hề biết biết <code>m</code>).</p> <p>Khi SHA-1 tính giá trị hash cho <code>m'</code>, đầu tiên nó cũng là một việc là chèn thêm các bit padding vào, các bit này hoàn toàn phụ thuộc vào độ dài của <code>m'</code> (mà độ dài này tôi đã biết rồi). Bây giờ, kết quả sau khi chèn sẽ là <code>m||p||z||p'</code>. Sau đó các block 512 bit sẽ được xử lý từng block một.</p> <p>Vì không biết đầy đủ nội dung, tôi không thể làm được việc này. Tôi không thể tự tính hash cho <code>m'</code>. Nhưng tôi biết nó được tính như thế nào.</p> <p>Độ dài của <code>m||p</code> chắc chắn là bội của 512 (đương nhiên, độ dài này tôi hoàn toàn biết được). Tôi không biết nó được xử lý như thế nào, nhưng tôi biết sau khi xử lý hết các block của <code>m||p</code> kết quả thu được chính là hash của nó, <code>h</code>.</p> <p>Sau đó, sử dụng giá trị này, tôi tiếp tục tính SHA-1 cho <code>m'</code>. Với running state hiện tại chính là <code>h</code>, tôi chỉ cần tiếp tục quá trình xử lý từng block 512 bit một với chuỗi <code>z||p'</code>.</p> <p>Đây chính là mấu chốt của vấn đề, tôi có thể tính SHA-1 của <code>m'</code> từ SHA-1 của <code>m</code> mà hoàn toàn không biết nội dung của nó. Tuy nhiên, có một yêu cầu tiên quyết đó là tôi phải biết độ dài của nó.</p> <p>Ở trên là tôi ví dụ với thuật toán SHA-1, các thuật toán khác hoàn toàn tương tự. Tất cả các thuật toán sử dụng hàm hash Merkle-Damgård như MD5, SHA-256, SHA-512 đều có thể bị tấn công bằng cách này.</p> <h1 id=cach-thuc-tan-cong-oi-voi-mac>Cách thức tấn công đối với MAC<a class=headerlink href=#cach-thuc-tan-cong-oi-voi-mac title="Permanent link">&para;</a></h1> <p>Vậy một kẻ tấn công làm thế nào với trường hợp một trang Web sử dụng kỹ thuật MAC mà tôi nói trên? Rất đơn giản, khi truy cập trang Web, kẻ tấn công được set cookie là <code>data</code> và <code>signature</code>. Hắn không biết <code>salt</code> được lưu trên server nhưng nếu hắn biết được độ dài của nó. Có nghĩa là hắn hoàn toàn biết được độ dài của <code>satl||data</code> được dùng để tính hash. Với độ dài trên và <code>signature</code> chính là hash của nó, hắn ta có thể chèn thêm dữ liệu giả mạo vào cookie và tính signature mới. Ví dụ, hắn chèn cookie <code>data = data||padding||fake</code> và tính signature mới cho dữ liệu giả mạo này. Khi server kiểm tra, signature hoàn toàn trùng khớp với dữ liệu giả. Vậy là kẻ tấn công đã thành công.</p> <h1 id=phong-chong>Phòng chống<a class=headerlink href=#phong-chong title="Permanent link">&para;</a></h1> <p>Vì kỹ thuật tấn công trên, với chúng ta là những người phát triển Web, chúng ta cần một số biện pháp phòng chống</p> <ul> <li>Không sử dụng MAC, đừng tin tưởng vào những gì người dùng gửi lên. Hãy tìm cách khác để xử lý dữ liệu của người dùng.</li> <li>Nếu bắt buộc phải sử dụng thì có một biện pháp phòng chống nổi tiếng nhất là sử dụng <a href=https://en.wikipedia.org/wiki/Hash-based_message_authentication_code>HMAC</a> thay cho MAC. HMAC được cho là có thể chống được tấn công mở rộng độ dài hash</li> <li>Một vài thuật toán mã hoá không xử dụng hàm hash Merkle-Damgård như MD-2, SHA-224, SHA-338 không bị tấn công bởi cách này, bạn có thể dùng chúng.</li> </ul> <h1 id=thuc-hanh>Thực hành<a class=headerlink href=#thuc-hanh title="Permanent link">&para;</a></h1> <p>Mặc dù lý thuyết như trên, có vẻ rất đơn giản. Nhưng khi thực hành lại không đơn giản chút nào. Vì tôi không có khả năng tính toán thành thạo với dữ liệu kiểu bit nên tôi mất khá nhiều thời gian để thực hiện.</p> <p>Tôi sẽ giải thích từng bước. Đầu tiên, tôi giả sử dữ liệu ban đầu là <code>secret</code> và sử dụng thuật toán SHA-1.</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>hashlib</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=sa>b</span><span class=s2>&quot;secret&quot;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
<span class=go>b&#39;\xe5\xe9\xfa\x1b\xa3\x1e\xcd\x1a\xe8Ou\xca\xaaGO:f?\x05\xf4&#39;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
<span class=go>&#39;e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4&#39;</span>
</pre></div> <p>Vậy là SHA-1 của <code>secret</code> viết dưới dạng hexa là <code>e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4</code>. Bây giờ, tôi sẽ tìm cách viết thêm vào sau <code>secret</code> một padding và một đoạn string nữa, ví dụ <code>append</code>. Và tôi sẽ tính SHA-1 cho chuỗi mới này theo lý thuyết ở trên mà không cần dùng đến nội dung của <code>secret</code>, tôi chỉ cần biết độ dài của nó là <code>6</code>. Bạn sẽ thấy rằng SHA-1 mà tôi tính được hoàn toàn giống với SHA-1 được tính một cách bình thường.</p> <h2 id=padding-cua-secret-va-append>Padding của <code>secret</code> và <code>append</code><a class=headerlink href=#padding-cua-secret-va-append title="Permanent link">&para;</a></h2> <p>Đặc tả của SHA-1 đã rất rõ ràng, tôi không đi sâu vào chi tiết nữa. Như đã nói ở trên, padding không phụ thuộc vào nội dung của đầu vào mà chỉ phụ thuộc vào độ dài của nó mà thôi.</p> <p>Padding của <code>secret</code> như sau:</p> <div class=codehilite><pre><span></span>\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000
</pre></div> <p>Như vậy chuỗi mới sẽ là</p> <div class=codehilite><pre><span></span>secret\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000append
</pre></div> <p>Bây giờ, tôi cần tính padding của chuỗi mới này, đây là một chuỗi có 70 byte. Padding của nó sẽ là</p> <div class=codehilite><pre><span></span>\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x020
</pre></div> <h2 id=ham-nen-cua-sha-1>Hàm nén của SHA-1<a class=headerlink href=#ham-nen-cua-sha-1 title="Permanent link">&para;</a></h2> <p>Dưới đây là hàm nén của SHA-1, nó nhận đầu vào là running state hiện tại, là một chuỗi của 5 string có độ dài 32 bit (tổng là 160 bit), một đầu vào khác là block cần xử lý. Đầu ra của nó là running state mới, trong trường hợp vì chỉ có 1 block nên nó cũng là kết quả cuối cùng.</p> <p>Đây là một cài đặt viết bằng Python, tuy hơi sơ sài nhưng nó chạy đúng ;)</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>compress</span><span class=p>(</span><span class=n>block</span><span class=p>,</span>
    <span class=n>state</span><span class=o>=</span><span class=p>(</span>
        <span class=mh>0x67452301</span><span class=p>,</span>
        <span class=mh>0xefcdab89</span><span class=p>,</span>
        <span class=mh>0x98badcfe</span><span class=p>,</span>
        <span class=mh>0x10325476</span><span class=p>,</span>
        <span class=mh>0xc3d2e1f0</span>
    <span class=p>)):</span>
    <span class=n>lrot</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>,</span> <span class=n>n</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=n>n</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>x</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=mi>32</span> <span class=o>-</span> <span class=n>n</span><span class=p>))</span>
    <span class=n>w</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>block</span><span class=p>)</span> <span class=o>//</span> <span class=mi>32</span><span class=p>):</span>
        <span class=n>w</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>block</span><span class=p>[</span><span class=n>j</span> <span class=o>*</span> <span class=mi>32</span><span class=p>:</span> <span class=n>j</span> <span class=o>*</span> <span class=mi>32</span> <span class=o>+</span> <span class=mi>32</span><span class=p>],</span> <span class=mi>2</span><span class=p>))</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span> <span class=mi>80</span><span class=p>):</span>
        <span class=n>w</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>lrot</span><span class=p>(</span><span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>8</span><span class=p>]</span> <span class=o>^</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>14</span><span class=p>]</span> <span class=o>^</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>16</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span><span class=p>)</span>

    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>e</span> <span class=o>=</span> <span class=n>state</span>

    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>80</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>19</span><span class=p>:</span>
            <span class=n>f</span><span class=p>,</span> <span class=n>k</span> <span class=o>=</span> <span class=n>d</span> <span class=o>^</span> <span class=p>(</span><span class=n>b</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>c</span> <span class=o>^</span> <span class=n>d</span><span class=p>)),</span> <span class=mh>0x5a827999</span>
        <span class=k>elif</span> <span class=mi>20</span> <span class=o>&lt;=</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>39</span><span class=p>:</span>
            <span class=n>f</span><span class=p>,</span> <span class=n>k</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>c</span> <span class=o>^</span> <span class=n>d</span><span class=p>,</span> <span class=mh>0x6ed9eba1</span>
        <span class=k>elif</span> <span class=mi>40</span> <span class=o>&lt;=</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>59</span><span class=p>:</span>
            <span class=n>f</span><span class=p>,</span> <span class=n>k</span> <span class=o>=</span> <span class=p>(</span><span class=n>b</span> <span class=o>&amp;</span> <span class=n>c</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>d</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>b</span> <span class=o>|</span> <span class=n>c</span><span class=p>)),</span> <span class=mh>0x8f1bbcdc</span>
        <span class=k>elif</span> <span class=mi>60</span> <span class=o>&lt;=</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>79</span><span class=p>:</span>
            <span class=n>f</span><span class=p>,</span> <span class=n>k</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>c</span> <span class=o>^</span> <span class=n>d</span><span class=p>,</span> <span class=mh>0xca62c1d6</span>

        <span class=n>temp</span> <span class=o>=</span> <span class=n>lrot</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>f</span> <span class=o>+</span> <span class=n>e</span> <span class=o>+</span> <span class=n>k</span> <span class=o>+</span> <span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
        <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>e</span> <span class=o>=</span> <span class=n>temp</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>lrot</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mi>30</span><span class=p>),</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span>
    <span class=n>h0</span> <span class=o>=</span> <span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>a</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
    <span class=n>h1</span> <span class=o>=</span> <span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
    <span class=n>h2</span> <span class=o>=</span> <span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=n>c</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
    <span class=n>h3</span> <span class=o>=</span> <span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>+</span> <span class=n>d</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
    <span class=n>h4</span> <span class=o>=</span> <span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>+</span> <span class=n>e</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xffffffff</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>,</span> <span class=n>h4</span><span class=p>)</span>
</pre></div> <p>Các giá trị <code>0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0</code> chính là running state được khởi tạo. Tuy nhiên bạn không cần quan tâm đến nó. Ở đây chúng ta cần quan tâm đến SHA-1 của <code>secret</code> cũng chính là running state hiện tại.</p> <h2 id=tinh-sha-1-cho-chuoi-moi>Tính SHA-1 cho chuỗi mới<a class=headerlink href=#tinh-sha-1-cho-chuoi-moi title="Permanent link">&para;</a></h2> <p>Tôi cần tính SHA-1 cho chuỗi mới với lý thuyết ở trên. Hiện nay tôi đang có running state là <code>e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4</code> tôi sẽ sử dụng giá trị này với hàm compress ở trên và block cần tính sẽ là</p> <div class=codehilite><pre><span></span>append\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x020
</pre></div> <p>Quá trình tính như sau:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=n>a</span> <span class=o>=</span> <span class=mh>0xe5e9fa1b</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>b</span> <span class=o>=</span> <span class=mh>0xa31ecd1a</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>c</span> <span class=o>=</span> <span class=mh>0xe84f75ca</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>d</span> <span class=o>=</span> <span class=mh>0xaa474f3a</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>e</span> <span class=o>=</span> <span class=mh>0x663f05f4</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;append</span><span class=se>\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02</span><span class=s2>0&quot;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>block</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>format</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>msg</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>r</span> <span class=o>=</span> <span class=n>compress</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>e</span><span class=p>))</span>
<span class=gp>&gt;&gt;&gt; </span><span class=s2>&quot;&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=s2>&quot;</span><span class=si>%08x</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>a</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>r</span><span class=p>])</span>
<span class=go>&#39;84cf06ff6b78bfe100edd0463ca56a816fd632eb&#39;</span>
</pre></div> <p><code>84cf06ff6b78bfe100edd0463ca56a816fd632eb</code> chính là SHA-1 hash của chuỗi mới. Tôi đã tính nó hoàn toàn dựa trên lý thuyết về tấn công mở rộng hash mà không cần sử dụng chuỗi <code>secret</code> ban đầu.</p> <p>Kiểm tra lại với cách tính SHA-1 thông thường.</p> <p>Chuỗi cần tính như sau:</p> <div class=codehilite><pre><span></span>secret\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000append
</pre></div> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>hashlib</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>msg</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&quot;secret</span><span class=se>\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class=s2>0append&quot;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>m</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
<span class=go>&#39;84cf06ff6b78bfe100edd0463ca56a816fd632eb&#39;</span>
</pre></div> <p>Như vậy tôi đã thành công khi điền thêm vào chuỗi ban đầu đoạn padding và chuỗi <code>append</code> để tạo thành chuỗi mới. Và tôi đã tính được SHA-1 của chuỗi mới mà không cần biết chuỗi ban đầu. Tôi chỉ biết độ dài của nó là đủ.</p> <p>Nếu một trang Web set cookie cho tôi như sau:</p> <div class=codehilite><pre><span></span>data = &quot;&quot;
signature = &quot;e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4&quot;
</pre></div> <p>Tôi có thể đặt lại cookie như sau:</p> <div class=codehilite><pre><span></span>data = \x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000append
signature = 84cf06ff6b78bfe100edd0463ca56a816fd632eb
</pre></div> <p>Như vậy nếu server có kiểm tra signature thì dữ liệu của tôi cũng hoàn toàn hợp lệ, vì signature của tôi trùng khớp với những gì server sẽ tính. Vậy là tôi đã crack thành công và gửi lên server dữ liệu giả mạo hoàn toàn do tôi tạo ra.</p> </div> <div class=post-footer> <div class=tags> <i class="fa fa-tags"></i> <span>#Hash</span> <span>#Security</span> <span>#Attack</span> <span>#Crack</span> </div> </div> </div><div class=blog-pager> <span class=newer-link> <a href=/2015/Oct/12/phu-quoc-travel.html> Newer Post </a> </span> <span class=older-link> <a href=/2015/Aug/30/web-development-with-cherrypy-and-jinja2.html> Older Post </a> </span> </div><div class=comments> <div class=finally> <p><em>I apologise for any typos. If you notice a problem, please let me know.</em> <p>Thank you all for your attention. </div> <div id=disqus_thread></div> <script src=/theme/js/disqus.min.js?81e8a5f5></script> <noscript> Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript> comments powered by Disqus. </a> </noscript> </div></div> </div> </div> <div class=sidebar-wrapper> <div class=widget> <h2>Welcome</h2> <div> <img src=/theme/images/banner.gif alt=Welcome> </div> </div><div class="widget recent-posts"> <h2>Recent Posts</h2> <ul> <li> <a href=/2019/May/20/elasticsearch-data-organization.html> <img alt="Elasticsearch: Data organization" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-data-organization.html>Elasticsearch: Data organization</a> <li> <a href=/2019/May/20/elasticsearch-intro.html> <img alt="Elasticsearch: Intro" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-intro.html>Elasticsearch: Intro</a> <li> <a href=/2019/Apr/20/javascript-popups.html> <img alt="JavaScript: Popups" src=https://i.imgur.com/FxmcwPy.png> </a> <a href=/2019/Apr/20/javascript-popups.html>JavaScript: Popups</a> <li> <a href=/2019/Mar/20/javascript-iterator-and-generator.html> <img alt="JavaScript: Iterator and generator" src=https://i.imgur.com/lev8iT9.jpg> </a> <a href=/2019/Mar/20/javascript-iterator-and-generator.html>JavaScript: Iterator and generator</a> <li> <a href=/2019/Feb/20/javascript-decorator.html> <img alt="JavaScript decorator" src=https://i.imgur.com/Sh3yLI0.png> </a> <a href=/2019/Feb/20/javascript-decorator.html>JavaScript decorator</a> </ul> </div><div class="widget labels"> <h2>Blog Archive</h2> <ul> <li> <a href=/2019/ > 2019 </a> <li> <a href=/2018/ > 2018 </a> <li> <a href=/2017/ > 2017 </a> <li> <a href=/2016/ > 2016 </a> <li> <a href=/2015/ > 2015 </a> <li> <a href=/2014/ > 2014 </a> <li> <a href=/2013/ > 2013 </a> <li> <a href=/2012/ > 2012 </a> <li> <a href=/2011/ > 2011 </a> <li> <a href=/2010/ > 2010 </a> </ul> </div><div class=widget> <h2>Twitter timeline</h2> <a class=twitter-timeline data-height=500 data-dnt=true data-theme=light href=https://twitter.com/_naa_4f data-chrome="noheader nofooter transparent noborders"> Tweets by manhhomienbienthuy </a> </div> </div> </div> <a href=# class="smooth-scroll back-to-top"> <i class="fa fa-arrow-circle-up fa-3x"></i> </a> </main> <footer> <div class=infos> <div class=wrapper> <div class=widget> <a href=/ title="manhhomienbienthuy's space" class=logo> <img alt="manhhomienbienthuy's space" src=/theme/images/logo_white.png> </a> <span class=right>I'm a hacker, enter my world...</span> </div><div class=widget> <p> Created with all my ♥ and soul, dedicated to my love, yunachan <p> Powered by <a href=http://blog.getpelican.com/ target=_blank>Pelican</a>, which takes great advantage of <a href=https://www.python.org/ target=_blank>Python</a> <p> This site content is licensed under a <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank> CC BY-NC-ND 4.0 </a> License. <p> Updated at <a target=_blank href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=2019-06-20T02:42:55"> 2019-06-20 02:42:55 </a> </div><div class=widget> <p> Hosting by <a href=https://manhhomienbienthuy.bitbucket.io/ >Bitbucket</a> and <a href=https://manhhomienbienthuy.github.io/ >Github</a>, image hosting by <a href=https://manhhomienbienthuy.imgur.com/ target=_blank>imgur</a>, <a href=https://instagram.com/manhhomienbienthuy/ target=_blank>Instagram</a> and <a href=https://photos.google.com/ target=_blank>Google Photo</a> <p> Theme based on <a href=https://vanice-veethemes.blogspot.com/ target=_blank>Vanice theme</a>, icons from <a href=https://fontawesome.com/ target=_blank>Font Awesome</a>, comments powered by <a href=https://disqus.com/home/forums/manhhomienbienthuy/ target=_blank>Disqus</a> </div> </div> </div> <div class=credits> <div class=wrapper> <div class=left> <!--
          Regarding copyright, in general, standalone pages (as
          opposed to files generated as part of manuals) on the GNU
          web server should be under CC BY-ND 4.0.  Please do NOT
          change or remove this without talking with the webmasters or
          licensing team first.  Please make sure the copyright date
          is consistent with the document.  For web pages, it is ok to
          list just the latest year the document was modified, or
          published.

          If you wish to list earlier years, that is ok too.  Either
          "2001, 2002, 2003" or "2001-2003" are ok for specifying
          years, as long as each year in the range is in fact a
          copyrightable year, i.e., a year in which the document was
          published (including being publicly visible on the web or in
          a revision control system).
        --> Copyright © 2010-2019 <a href=/pages/about-me.html><strong>manhhomienbienthuy</strong></a>. All rights reserved. </div> <div class=right> <ul> <li><a href=/ >Home</a> <li><a href=/pages/about-me.html>About</a> <li><a href=# class=smooth-scroll>Top ↑</a> </ul> </div> </div> </div></footer> <script src=https://code.jquery.com/jquery-3.2.1.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js></script> <script src=/theme/js/vpyeu.min.js?d72c87bd></script> <script id=dsq-count-scr src=https://manhhomienbienthuy.disqus.com/count.js async></script>