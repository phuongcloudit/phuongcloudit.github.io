<!DOCTYPE html><title>Exploring Python decorators - manhhomienbienthuy's space</title> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=apple-touch-icon href=/theme/images/icon-touch.png> <link rel=icon sizes=192x192 href=/theme/images/icon-touch.png> <link rel="shortcut icon" href=/theme/images/favicon.ico> <link rel=author href=/humans.txt> <meta name=msapplication-TileImage content=/theme/images/icon-tile.png> <meta name=twitter:dnt content=on> <meta name=Author content=manhhomienbienthuy> <meta name=rating content=general> <meta name=twitter:card content=product> <meta name=twitter:site content=@_naa_4f> <meta name=twitter:creator content=@_naa_4f> <link href=/feeds/all.atom.xml type=application/atom+xml rel=alternate title="manhhomienbienthuy's space Full Atom Feed"> <meta name=description content="Decorator trong Python được sử dụng khá nhiều, tuy nhiên nó cũng hơi khó hiểu một chút. Decorator cho chúng ta một cú pháp đơn giản để gọi các hàm bậc cao (higher-order functions). Về mặt lý thuyết, một decorator là một hàm nhận tham số đầu vào là một …"> <meta name=keywords content="Python, decorator, fundamental, blog, naa, manhhomienbienthuy, pelican, static site generator"> <meta name=twitter:title content="Exploring Python decorators - manhhomienbienthuy's space"> <meta name=twitter:description content="Decorator trong Python được sử dụng khá nhiều, tuy nhiên nó cũng hơi khó hiểu một chút. Decorator cho chúng ta một cú pháp đơn giản để gọi các hàm bậc cao (higher-order functions). Về mặt lý thuyết, một decorator là một hàm nhận tham số đầu vào là một …"> <meta name=twitter:image content=/https://i.imgur.com/Y20vNKl.png> <link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css> <link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css> <link rel=stylesheet href=/theme/css/vpyeu.min.css?5d2c7d5e> <header> <div class=navbar> <div class=wrapper> <div class=nav-menu> <div class=menu-toggle> <i class="fa fa-reorder"></i> </div> <ul class=menus> <li><a href=/ >Home</a> <li><a href=/category/general.html> General <li><a href=/category/life.html> Life <li><a href=/category/programming.html class=current> Programming <li><a href=/category/travel.html> Travel </ul> </div><div class="right links"> <ul> <li> <a href=https://twitter.com/_naa_4f target=_blank> <i class="fa fa-twitter"></i> </a> <li> <a href=https://instagram.com/manhhomienbienthuy/ target=_blank> <i class="fa fa-instagram"></i> </a> <li> <a href=https://www.facebook.com/manhhomienbienthuy target=_blank> <i class="fa fa-facebook"></i> </a> <li> <a href=https://github.com/manhhomienbienthuy target=_blank> <i class="fa fa-github"></i> </a> <li> <a href=/feeds/all.atom.xml target=_blank> <i class="fa fa-rss"></i> </a> </ul> </div> </div> </div><noscript> <div class="warning head-warn"> <div class=wrapper> <p><strong>Notice:</strong> While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </div> </div> </noscript><div class=banner> <div class=wrapper> <a href=/ > <img alt="manhhomienbienthuy's space" src=/theme/images/logo.png> </a> </div> </div></header> <main> <div class=wrapper> <div class=main-wrapper> <div class=entry> <div class=entry-detail> <div class=post> <h1 class=title> Exploring Python decorators </h1> <div class=meta> Posted in <a href=/category/programming.html>Programming</a> on December 22, 2015 by <a href=/pages/about-me.html>manhhomienbienthuy</a> <span class=right> <i class="fa fa-comments"></i> <a href=#disqus_thread data-disqus-identifier=/2015/Dec/22/exploring-python-decorators.html> Comments </a> </span> </div> <div class=post-body> <img src=https://i.imgur.com/Y20vNKl.png alt="Exploring Python decorators"> <p><a href=https://www.python.org/dev/peps/pep-0318/ >Decorator</a> trong Python được sử dụng khá nhiều, tuy nhiên nó cũng hơi khó hiểu một chút. Decorator cho chúng ta một cú pháp đơn giản để gọi các hàm bậc cao (<a href=http://en.wikipedia.org/wiki/Higher-order_function>higher-order functions</a>). Về mặt lý thuyết, một decorator là một hàm nhận tham số đầu vào là một hàm khác và mở rộng tính năng cho hàm đó mà không thay đổi nội dung của nó. Tuy nhiên, decorator không chỉ có vậy, nó thực sự còn làm nhiều việc khác nữa. Chúng ta sẽ dần dần khám phá trong bài viết này.</p> <p>Trong bài viết này, tôi sẽ giới thiệu một cách ngắn gọn và dễ hiểu về decorator, cách sử dụng chúng và cách tự viết một decorator cho riêng mình.</p> <blockquote> <p>Từ "decorator" được sử dụng trong Python có một chút biến đổi. Bạn hãy cẩn thận vì nó rất dễ gây nhầm lẫn với một design pattern cũng tên là <a href=https://en.wikipedia.org/wiki/Decorator_pattern>decorator</a>. Thực ra, chúng ta có thể sử dụng decorator trong Python để cài đặt decorator pattern. Nhưng có rất nhiều hạn chế trong cách làm này. Theo tôi thấy thì decorator của Python có nhiều nét giống với macro hơn.</p> </blockquote> <h1 id=co-so-ly-thuyet>Cơ sở lý thuyết<a class=headerlink href=#co-so-ly-thuyet title="Permanent link">&para;</a></h1> <p>Trước khi bạn có thể hiểu các decorator, thì bạn cần hiểu một số khái niệm cơ bản của Python trước, trong phần này, chúng ta sẽ dần dần tìm hiểu những khái niệm đó.</p> <h2 id=ham>Hàm<a class=headerlink href=#ham title="Permanent link">&para;</a></h2> <p>Hàm là một khái niệm rất cơ bản trong lập trình nói chung và Python nói riêng, nên tôi nghĩ không cần nói nhiều về nó. Đương nhiên các hàm sẽ trả về kết quả dựa trên tham số đầu vào của nó:</p> <div class=codehilite><pre><span></span><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span> <span class=nf>greet</span><span class=p>(</span><span class=n>word</span><span class=o>=</span><span class=s2>&quot;Hello&quot;</span><span class=p>):</span>
<span class=gp>... </span>    <span class=k>print</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
<span class=gp>...</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>greet</span><span class=p>()</span>
<span class=go>Hello</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>greet</span><span class=p>(</span><span class=s2>&quot;Hello, world&quot;</span><span class=p>)</span>
<span class=go>Hello, world</span>
<span class=go>&gt;&gt;&gt;</span>
</pre></div> <p>Tôi nghĩ không cần phải nói nhiều về khái niệm này nữa, nó rất dễ hiểu. Nên chúng ta sẽ chuyển sang khái niệm tiếp theo.</p> <h2 id=ham-cung-la-oi-tuong>Hàm cũng là đối tượng<a class=headerlink href=#ham-cung-la-oi-tuong title="Permanent link">&para;</a></h2> <p>Trong Python, hàm cũng là đối tượng, hơn nữa nó còn là đối tượng <a href=http://python-history.blogspot.com/2009/02/first-class-everything.html>first-class</a>. Điều đó cho rất nhiều kết quả quan trọng. Chúng ta sẽ tìm hiểu thông qua một số ví dụ sau:</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>shout</span><span class=p>(</span><span class=n>word</span><span class=o>=</span><span class=s2>&quot;aaa&quot;</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>word</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&quot;!&quot;</span>

<span class=nb>print</span><span class=p>(</span><span class=n>shout</span><span class=p>())</span> <span class=c1># output: AAA!</span>

<span class=c1># Bởi vì hàm cũng là đối tượng nên chúng ta có thể gán nó cho các</span>
<span class=c1># biến như những đối tượng khác.</span>
<span class=n>scream</span> <span class=o>=</span> <span class=n>shout</span>

<span class=c1># Như bạn đã thấy rằng, chúng ta không dùng dấu ngoặc, bởi vì</span>
<span class=c1># chúng ta không gọi hàm, mà chúng ta đang gán hàm cho biến khác</span>
<span class=c1># (scream).  Sau khi gán, chúng ta có thể gọi hàm shout từ biến</span>
<span class=c1># scream.</span>
<span class=nb>print</span><span class=p>(</span><span class=n>scream</span><span class=p>())</span> <span class=c1># output: AAA!</span>

<span class=c1># Không chỉ gán biến, chúng ta còn có thể xoá hàm như xoá những</span>
<span class=c1># đối tượng thông thường khác.</span>
<span class=k>del</span> <span class=n>shout</span>
<span class=k>try</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>shout</span><span class=p>())</span>
<span class=k>except</span> <span class=ne>NameError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<span class=c1># output: name &#39;shout&#39; is not defined</span>

<span class=c1># Tuy nhiên, chúng ta vẫn có thể gọi hàm thông qua biến scream.</span>
<span class=nb>print</span><span class=p>(</span><span class=n>scream</span><span class=p>())</span> <span class=c1># output: AAA!</span>
</pre></div> <h2 id=cac-ham-long-nhau>Các hàm lồng nhau<a class=headerlink href=#cac-ham-long-nhau title="Permanent link">&para;</a></h2> <p>Vì hàm là các đối tượng first-class (thực ra trong Python, mọi thứ đều là đối tượng first-class) nên nó có một đặc tính khá thú vị là nó có thể được định nghĩa bên trong một hàm khác. Các hàm như vậy gọi là các hàm lồng nhau.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>talk</span><span class=p>():</span>

    <span class=c1># Bạn có thể định nghĩa các hàm bên trong hàm `talk`</span>
    <span class=k>def</span> <span class=nf>whisper</span><span class=p>(</span><span class=n>word</span><span class=o>=</span><span class=s2>&quot;aaa&quot;</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>word</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&quot;...&quot;</span>

    <span class=c1># Và sau đó sử dụng hàm này</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>whisper</span><span class=p>())</span>

<span class=c1># Bạn có thể gọi hàm talk, mỗi lần bạn gọi hàm này, hàm whisper</span>
<span class=c1># sẽ được định nghĩa sau đó thực thi ở bên trong hàm talk.</span>
<span class=n>talk</span><span class=p>()</span> <span class=c1># output: aaa...</span>

<span class=c1># Nhưng bạn không thể gọi hàm whisper từ bên ngoài.</span>
<span class=k>try</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>whisper</span><span class=p>())</span>
<span class=k>except</span> <span class=ne>NameError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
<span class=c1># output: name &#39;whisper&#39; is not defined</span>
</pre></div> <p><strong>Bài học rút ra</strong></p> <p>Hàm là các đối tượng (hơn nữa là đối tượng first-class), vì vậy:</p> <ul> <li>Hàm có thể được gán cho các biến.</li> <li>Hàm có thể được định nghĩa trong một hàm khác.</li> </ul> <p>Vì những đặc điểm trên hàm còn <strong>có thể trả kết quả (<code>return</code>) là một hàm khác</strong>.</p> <h2 id=mot-ham-tra-ket-qua-la-mot-ham-khac>Một hàm trả kết quả là một hàm khác<a class=headerlink href=#mot-ham-tra-ket-qua-la-mot-ham-khac title="Permanent link">&para;</a></h2> <p>Python cho phép bạn viết một hàm mà hàm đó trả kết quả về là một hàm khác. Ví dụ:</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>get_talk</span><span class=p>(</span><span class=n>kind</span><span class=o>=</span><span class=s2>&quot;shout&quot;</span><span class=p>):</span>

    <span class=c1># Trước hết, chúng ta định nghĩa các hàm</span>
    <span class=k>def</span> <span class=nf>shout</span><span class=p>(</span><span class=n>word</span><span class=o>=</span><span class=s2>&quot;aaa&quot;</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>word</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&quot;!&quot;</span>

    <span class=k>def</span> <span class=nf>whisper</span><span class=p>(</span><span class=n>word</span><span class=o>=</span><span class=s2>&quot;aaa&quot;</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>word</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&quot;...&quot;</span>

    <span class=c1># Bây giờ, chúng ta sẽ trả kết quả về những hàm này</span>
    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>&quot;shout&quot;</span><span class=p>:</span>
        <span class=c1># Chúng ta không sử dụng dấu ngoặc (), bởi vì chúng ta</span>
        <span class=c1># không gọi những hàm này, mà chúng ta return đối tượng</span>
        <span class=c1># tương ứng với các hàm.</span>
        <span class=k>return</span> <span class=n>shout</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>whisper</span>

<span class=c1># Gọi những thứ trên như thế nào?</span>

<span class=c1># Chúng ta gọi hàm và gán kết quả cho một biến</span>
<span class=n>talk</span> <span class=o>=</span> <span class=n>get_talk</span><span class=p>()</span>

<span class=c1># Bạn có thể thấy talk bây giờ là một đối tượng hàm</span>
<span class=nb>print</span><span class=p>(</span><span class=n>talk</span><span class=p>)</span> <span class=c1># output: &lt;function get_talk.&lt;locals&gt;.shout at 0x101bdbae8&gt;</span>

<span class=c1># Đối tượng hàm này là một trong hai hàm con của get_talk</span>
<span class=nb>print</span><span class=p>(</span><span class=n>talk</span><span class=p>())</span> <span class=c1># output: AAA!</span>

<span class=c1># Bạn có thể dùng cách gọi ngắn gọn hơn nếu đã thành thạo</span>
<span class=nb>print</span><span class=p>(</span><span class=n>get_talk</span><span class=p>(</span><span class=s2>&quot;whisper&quot;</span><span class=p>)())</span> <span class=c1># output: aaa...</span>
</pre></div> <p>Không chỉ có thể trả kết quả là một hàm, hàm còn thể được truyền vào hàm khác như là một tham số.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>do_smth_before</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Something before calling function&quot;</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>func</span><span class=p>())</span>

<span class=nb>print</span><span class=p>(</span><span class=n>scream</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Something before calling function</span>
<span class=c1># AAA!</span>
</pre></div> <p>Trên đây là những thứ cần thiết để hiểu về decorator của Python. Bạn sẽ thấy rằng, decorator là "wrapper" cho phép bạn chạy một số đoạn code trước hoặc sau hàm chính mà không thay đổi nội dung của nó.</p> <h1 id=python-decorator-co-ban>Python decorator cơ bản<a class=headerlink href=#python-decorator-co-ban title="Permanent link">&para;</a></h1> <p>Khi có một hàm mà bạn muốn chạy một số code trước, hoặc sau hàm đó, bạn sẽ làm thế nào?</p> <h2 id=lam-bang-tay>Làm bằng tay<a class=headerlink href=#lam-bang-tay title="Permanent link">&para;</a></h2> <p>Chúng ta có thể sử dụng kiến thức về các hàm lồng nhau ở trên, để giải quyết bài toán này.</p> <div class=codehilite><pre><span></span><span class=c1># Decorator là hàm nhận hàm khác làm tham số</span>
<span class=k>def</span> <span class=nf>decorator_function</span><span class=p>(</span><span class=n>function_to_decorate</span><span class=p>):</span>

    <span class=c1># Bên trong, chúng ta sẽ định nghĩa một &quot;wrapper&quot;.  Hàm này sẽ</span>
    <span class=c1># bao bọc xung quanh hàm gốc, vì thế chúng ta có thể chạy</span>
    <span class=c1># code trước hoặc sau hàm gốc đó</span>
    <span class=k>def</span> <span class=nf>wrapper_to_original_function</span><span class=p>():</span>
        <span class=c1># Đây là code được thực thi TRƯỚC hàm gốc</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Before calling function&quot;</span><span class=p>)</span>

        <span class=c1># Gọi hàm gốc, đây là gọi và thực thi hàm nên chúng ta sẽ</span>
        <span class=c1># dùng dấu ngoặc</span>
        <span class=n>function_to_decorate</span><span class=p>()</span>

        <span class=c1># Đây là code được thực thi SAU hàm gốc</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;After calling function&quot;</span><span class=p>)</span>

    <span class=c1># Vào thời điểm này, hàm gốc vẫn CHƯA thực sự dược thực thi,</span>
    <span class=c1># chúng ta sẽ return hàm wrapper mà chúng ta vừa tạo.  Hàm này</span>
    <span class=c1># chứa code được thực thi trước và sau hàm gốc, đặc biệt là</span>
    <span class=c1># nó có thể được thực thi.</span>
    <span class=k>return</span> <span class=n>wrapper_to_original_function</span>

<span class=c1># Giả sử bạn có một hàm mà không muốn ai thay đổi nó</span>
<span class=k>def</span> <span class=nf>a_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Do not modify it&quot;</span><span class=p>)</span>

<span class=n>a_function</span><span class=p>()</span> <span class=c1># output: Do not modify it</span>

<span class=c1># Bây giờ, bạn muốn mở rộng hành vi của hàm này, chạy một số code</span>
<span class=c1># trước và sau nó, hãy sử dụng decorator_function.  Truyền hàm này</span>
<span class=c1># như là tham số của hàm decorator, nó sẽ tự động bao bọc hàm, và</span>
<span class=c1># trả kết quả về là một hàm khác bạn có thể thực thi</span>
<span class=n>a_decorated_function</span> <span class=o>=</span> <span class=n>decorator_function</span><span class=p>(</span><span class=n>a_function</span><span class=p>)</span>

<span class=c1># Có thể bạn sẽ muốn chạy hàm a_decorated_function mỗi khi thực</span>
<span class=c1># thi hàm a_function.  Rất đơn giản, bạn chỉ cần override nó bằng</span>
<span class=c1># hàm trả về của decorator_function</span>
<span class=n>a_function</span> <span class=o>=</span> <span class=n>decorator_function</span><span class=p>(</span><span class=n>a_function</span><span class=p>)</span>

<span class=n>a_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># Before calling function</span>
<span class=c1># Do not modify it</span>
<span class=c1># After calling function</span>

<span class=c1># Đây chính là những gì mà decorator có thể làm</span>
</pre></div> <h2 id=decorator>Decorator<a class=headerlink href=#decorator title="Permanent link">&para;</a></h2> <p>Chúng có thể sử dụng cú pháp decorator của Python với ví dụ trên như sau:</p> <div class=codehilite><pre><span></span><span class=nd>@decorator_function</span>
<span class=k>def</span> <span class=nf>a_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Do not modify it&quot;</span><span class=p>)</span>

<span class=n>a_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># Before calling function</span>
<span class=c1># Do not modify it</span>
<span class=c1># After calling function</span>
</pre></div> <p>Rất dễ hiểu phải không? Cú pháp <code>@decorator</code> (còn gọi là pie syntax) là cách viết ngắn gọn của:</p> <div class=codehilite><pre><span></span><span class=n>a_function</span> <span class=o>=</span> <span class=n>decorator_function</span><span class=p>(</span><span class=n>a_function</span><span class=p>)</span>
</pre></div> <p>Thậm chí, bạn có thể sử dụng nhiều decorator cho một hàm, bởi kết quả trả về của decorator cũng là một hàm và nó hoàn toàn có thể được decorate bởi những decorator khác.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator1</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;*&quot;</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
        <span class=n>func</span><span class=p>()</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;*&quot;</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=k>def</span> <span class=nf>decorator2</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=&quot;</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
        <span class=n>func</span><span class=p>()</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=&quot;</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;hello&quot;</span><span class=p>)</span>

<span class=n>some_func</span><span class=p>()</span> <span class=c1># output: hello</span>
<span class=n>some_func</span> <span class=o>=</span> <span class=n>decorator1</span><span class=p>(</span><span class=n>decorator2</span><span class=p>(</span><span class=n>some_func</span><span class=p>))</span>
<span class=n>some_func</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># **********</span>
<span class=c1># ==========</span>
<span class=c1># hello</span>
<span class=c1># ==========</span>
<span class=c1># **********</span>
</pre></div> <p>Sử dụng cú pháp decorator của Python</p> <div class=codehilite><pre><span></span><span class=nd>@decorator1</span>
<span class=nd>@decorator2</span>
<span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;hello&quot;</span><span class=p>)</span>

<span class=n>some_func</span><span class=p>()</span>
<span class=c1># output giống như lúc trước</span>
<span class=c1># **********</span>
<span class=c1># ==========</span>
<span class=c1># hello</span>
<span class=c1># ==========</span>
<span class=c1># **********</span>

<span class=c1># Thứ tự của decorator cũng CÓ ảnh hưởng đến kết quả</span>
<span class=nd>@decorator2</span>
<span class=nd>@decorator1</span>
<span class=k>def</span> <span class=nf>some_func</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;hello&quot;</span><span class=p>)</span>
<span class=n>some_func</span><span class=p>()</span>
<span class=c1># output lần này đã khác</span>
<span class=c1># ==========</span>
<span class=c1># **********</span>
<span class=c1># hello</span>
<span class=c1># **********</span>
<span class=c1># ==========</span>
</pre></div> <h1 id=python-decorator-nang-cao>Python decorator nâng cao<a class=headerlink href=#python-decorator-nang-cao title="Permanent link">&para;</a></h1> <h2 id=truyen-tham-so-vao-ham-uoc-decorate>Truyền tham số vào hàm được decorate<a class=headerlink href=#truyen-tham-so-vao-ham-uoc-decorate title="Permanent link">&para;</a></h2> <div class=codehilite><pre><span></span><span class=c1># Không có bí mật gì ở đây.  Chúng ta chỉ cần cho hàm wrapper nhận</span>
<span class=c1># tham số là được</span>

<span class=k>def</span> <span class=nf>a_decorator_passing_arguments</span><span class=p>(</span><span class=n>function_to_decorate</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>a_wrapper_accepting_arguments</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I got args!&quot;</span><span class=p>,</span> <span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>)</span>
        <span class=n>function_to_decorate</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>a_wrapper_accepting_arguments</span>

<span class=c1># Bởi vì khi chúng ta gọi hàm, thực ra là chúng ta gọi hàm được</span>
<span class=c1># trả về bởi decorator (hàm wrapper), nên nếu chúng ta truyền</span>
<span class=c1># tham số cho hàm này thì nó sẽ truyền cho hàm được decorate.</span>

<span class=nd>@a_decorator_passing_arguments</span>
<span class=k>def</span> <span class=nf>print_full_name</span><span class=p>(</span><span class=n>first_name</span><span class=p>,</span> <span class=n>last_name</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;My name is&quot;</span><span class=p>,</span> <span class=n>first_name</span><span class=p>,</span> <span class=n>last_name</span><span class=p>)</span>

<span class=n>print_full_name</span><span class=p>(</span><span class=s2>&quot;naa&quot;</span><span class=p>,</span> <span class=s2>&quot;manhhomienbienthuy&quot;</span><span class=p>)</span>
<span class=c1># outputs:</span>
<span class=c1># I got args! naa manhhomienbienthuy</span>
<span class=c1># My name is naa manhhomienbienthuy</span>
</pre></div> <h1 id=decorate-mot-phuong-thuc>Decorate một phương thức<a class=headerlink href=#decorate-mot-phuong-thuc title="Permanent link">&para;</a></h1> <p>Hàm và phương thức của Python rất giống nhau, ngoại trừ một điểm, phương thức thuộc về một class mà nó luôn luôn có tham số đầu tiên là <code>self</code> (đối tượng hiện tại).</p> <p>Vì vậy, chúng ta có thể viết decorator cho phương thức giống như decorator cho hàm, chỉ với lưu ý rằng cần truyền tham số <code>self</code> cho wrapper.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>method_friendly_decorator</span><span class=p>(</span><span class=n>method_to_decorate</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lie</span><span class=p>):</span>
        <span class=n>lie</span> <span class=o>=</span> <span class=n>lie</span> <span class=o>-</span> <span class=mi>3</span> <span class=c1># very friendly, decrease age even more :-)</span>
        <span class=k>return</span> <span class=n>method_to_decorate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lie</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>wrapper</span>


<span class=k>class</span> <span class=nc>Wife</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>24</span>

    <span class=nd>@method_friendly_decorator</span>
    <span class=k>def</span> <span class=nf>say_your_age</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lie</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am </span><span class=si>%s</span><span class=s2>, what did you think?&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>+</span> <span class=n>lie</span><span class=p>))</span>

<span class=n>vp</span> <span class=o>=</span> <span class=n>Wife</span><span class=p>()</span>
<span class=n>vp</span><span class=o>.</span><span class=n>say_your_age</span><span class=p>(</span><span class=o>-</span><span class=mi>3</span><span class=p>)</span>
<span class=c1># outputs: I am 18, what did you think?</span>
</pre></div> <h2 id=decorator-tong-quat>Decorator tổng quát<a class=headerlink href=#decorator-tong-quat title="Permanent link">&para;</a></h2> <p>Nếu bạn muốn xây dựng một decorator một cách tổng quát, có thể áp dụng cho mọi hàm với số lượng tham số khác nhau. Bạn chỉ cần sử dụng cú pháp <code>*args</code> và <code>**kwargs</code></p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator_passing_arbitrary_arguments</span><span class=p>(</span><span class=n>function_to_decorate</span><span class=p>):</span>
    <span class=c1># Wrapper nhận mọi tham số đầu vào</span>
    <span class=k>def</span> <span class=nf>wrapper_accepting_arbitrary_arguments</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Do I have args?:&quot;</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=c1># Bây giờ truyền những tham số này cho hàm được decorate,</span>
        <span class=c1># nhớ unpack chúng.</span>
        <span class=n>function_to_decorate</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>wrapper_accepting_arbitrary_arguments</span>


<span class=nd>@decorator_passing_arbitrary_arguments</span>
<span class=k>def</span> <span class=nf>function_with_no_argument</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No arguments here&quot;</span><span class=p>)</span>

<span class=n>function_with_no_argument</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># Do I have args?:</span>
<span class=c1># ()</span>
<span class=c1># {}</span>
<span class=c1># No arguments here</span>

<span class=nd>@decorator_passing_arbitrary_arguments</span>
<span class=k>def</span> <span class=nf>function_with_arguments</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span>

<span class=n>function_with_arguments</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Do I have args?:</span>
<span class=c1># (1, 2, 3)</span>
<span class=c1># {}</span>
<span class=c1># 1 2 3</span>

<span class=nd>@decorator_passing_arbitrary_arguments</span>
<span class=k>def</span> <span class=nf>function_with_named_arguments</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>occupation</span><span class=o>=</span><span class=s2>&quot;programmer&quot;</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%s</span><span class=s2> is a </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>occupation</span><span class=p>))</span>

<span class=n>function_with_named_arguments</span><span class=p>(</span><span class=s2>&quot;Ngoc Anh&quot;</span><span class=p>,</span> <span class=n>occupation</span><span class=o>=</span><span class=s2>&quot;developer&quot;</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Do I have args?:</span>
<span class=c1># (&#39;Ngoc Anh&#39;,)</span>
<span class=c1># {&#39;occupation&#39;: &#39;developer&#39;}</span>
<span class=c1># Ngoc Anh is a developer</span>

<span class=k>class</span> <span class=nc>Husband</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>25</span>

    <span class=nd>@decorator_passing_arbitrary_arguments</span>
    <span class=k>def</span> <span class=nf>say_your_age</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>lie</span><span class=o>=-</span><span class=mi>3</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am </span><span class=si>%s</span><span class=s2>, what did you think ?&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>+</span> <span class=n>lie</span><span class=p>))</span>

<span class=n>na</span> <span class=o>=</span> <span class=n>Husband</span><span class=p>()</span>
<span class=n>na</span><span class=o>.</span><span class=n>say_your_age</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># Do I have args?:</span>
<span class=c1># (&lt;__main__.Husband object at 0x7f1244b65278&gt;,)</span>
<span class=c1># {}</span>
<span class=c1># I am 22, what did you think ?</span>
</pre></div> <h2 id=truyen-tham-so-cho-chinh-decorator>Truyền tham số cho chính decorator<a class=headerlink href=#truyen-tham-so-cho-chinh-decorator title="Permanent link">&para;</a></h2> <p>Bây giờ, nếu bạn muốn truyền tham số cho chính decorator thì phải làm thế nào? Bởi vì decorator nhận tham số là một hàm nên bạn không thể truyền tham số cho nó được.</p> <p>Trước khi đến với giải pháp, chúng ta xem qua ví dụ sau:</p> <div class=codehilite><pre><span></span><span class=c1># Decorator cũng là hàm THÔNG THƯỜNG</span>
<span class=k>def</span> <span class=nf>my_decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is an ordinary function&quot;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is function return by decorator&quot;</span><span class=p>)</span>
        <span class=n>func</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=c1># Do đó, bạn có thể gọi chúng là không cần dùng cú pháp `@`</span>
<span class=k>def</span> <span class=nf>lazy_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;lllllaaaaazzzzzyyyyy&quot;</span><span class=p>)</span>

<span class=n>decorated_function</span> <span class=o>=</span> <span class=n>my_decorator</span><span class=p>(</span><span class=n>lazy_function</span><span class=p>)</span>
<span class=c1># outputs: This is an ordinary function</span>

<span class=c1># Output của đoạn code trên là &quot;This is an ordinary function&quot; bởi</span>
<span class=c1># vì đơn giản là bạn vừa gọi hàm nên nó có kết quả như vậy.  Không</span>
<span class=c1># có gì khó hiểu ở đây cả.</span>

<span class=nd>@my_decorator</span>
<span class=k>def</span> <span class=nf>lazy_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;lllllaaaaazzzzzyyyyy&quot;</span><span class=p>)</span>

<span class=c1># outputs: This is an ordinary function</span>
</pre></div> <p>Hai cách làm cho kết quả giống hệt nhau. Đó là bởi vì khi bạn sử dụng cú pháp <code>@</code> thì Python sẽ gọi và thực thi hàm có tên là tên của decorator như thực thi một hàm thông thường.</p> <p>Điều này rất quan trọng, bởi vì bạn có thể dùng tên của decorator để <strong>trỏ tới chính hàm decorator đó hay không</strong>.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator_maker</span><span class=p>():</span>

    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Make decorator and excecute only once&quot;</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>my_decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am a decorator!&quot;</span><span class=p>)</span>

        <span class=k>def</span> <span class=nf>wrapped</span><span class=p>():</span>
            <span class=nb>print</span> <span class=p>(</span><span class=s2>&quot;I am the wrapper around the decorated function.&quot;</span><span class=p>)</span>
            <span class=n>func</span><span class=p>()</span>

        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;As the decorator, I return the wrapped function.&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>wrapped</span>

    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;As a decorator maker, I return a decorator&quot;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>my_decorator</span>

<span class=c1># Bây giờ, chúng ta sẽ tạo ra một decorator, đơn giản chỉ là gọi</span>
<span class=c1># các hàm</span>
<span class=n>new_decorator</span> <span class=o>=</span> <span class=n>decorator_maker</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># Make decorator and execute only once</span>
<span class=c1># As a decorator maker, I return a decorator</span>

<span class=c1># Sau đó là decorate hàm mà chúng ta muốn</span>
<span class=k>def</span> <span class=nf>decorated_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the decorated function.&quot;</span><span class=p>)</span>

<span class=n>decorated_function</span> <span class=o>=</span> <span class=n>new_decorator</span><span class=p>(</span><span class=n>decorated_function</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># I am a decorator!</span>
<span class=c1># As the decorator, I return the wrapped function.</span>

<span class=c1># Thử gọi hàm được decorate xem sao</span>
<span class=n>decorated_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># I am the wrapper around the decorated function.</span>
<span class=c1># I am the decorated function.</span>
</pre></div> <p>Chúng ta có thể làm điều tương tự bằng cách bỏ qua các biến trung gian</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorated_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the decorated function.&quot;</span><span class=p>)</span>
<span class=n>decorated_function</span> <span class=o>=</span> <span class=n>decorator_maker</span><span class=p>()(</span><span class=n>decorated_function</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Make decorator and execute only once</span>
<span class=c1># As a decorator maker, I return a decorator</span>
<span class=c1># I am a decorator!</span>
<span class=c1># As the decorator, I return the wrapped function.</span>

<span class=c1># Gọi hàm được decorate</span>
<span class=n>decorated_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># I am the wrapper around the decorated function.</span>
<span class=c1># I am the decorated function.</span>
</pre></div> <p>Thậm chí chúng ta có thể dùng cú pháp ngắn gọn hơn:</p> <div class=codehilite><pre><span></span><span class=nd>@decorator_maker</span><span class=p>()</span>
<span class=k>def</span> <span class=nf>decorated_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the decorated function.&quot;</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Make decorator and excecute only once</span>
<span class=c1># As a decorator maker, I return a decorator</span>
<span class=c1># I am a decorator!</span>
<span class=c1># As the decorator, I return the wrapped function</span>

<span class=c1># Thử gọi hàm xem sao</span>
<span class=n>decorated_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># I am the wrapper around the decorated function.</span>
<span class=c1># I am the decorated function.</span>
</pre></div> <p>Rất đơn giản, chúng ta có thể gọi và thực thi hàm trong chính cú pháp <code>@</code>.</p> <p>Quay trở lại với bài toán của chúng ta, nếu chúng ta xây dựng một hàm trả kết quả về là một decorator thì chúng ta có thể truyền tham số cho hàm đó.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator_maker_with_arguments</span><span class=p>(</span><span class=n>decorator_arg1</span><span class=p>,</span> <span class=n>decorator_arg2</span><span class=p>):</span>

    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I make decorators! And I accept arguments:&quot;</span><span class=p>,</span>
          <span class=n>decorator_arg1</span><span class=p>,</span> <span class=n>decorator_arg2</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>my_decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the decorator.  You passed me arguments:&quot;</span><span class=p>,</span>
              <span class=n>decorator_arg1</span><span class=p>,</span> <span class=n>decorator_arg2</span><span class=p>)</span>

        <span class=c1># Don&#39;t confuse decorator arguments and function arguments!</span>
        <span class=k>def</span> <span class=nf>wrapped</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>):</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the wrapper around the decorated function.</span><span class=se>\n</span><span class=s2>&quot;</span>
                  <span class=s2>&quot;I can access all the variables</span><span class=se>\n</span><span class=s2>&quot;</span>
                  <span class=s2>&quot;</span><span class=se>\t</span><span class=s2>- from the decorator: </span><span class=si>{0}</span><span class=s2> </span><span class=si>{1}</span><span class=se>\n</span><span class=s2>&quot;</span>
                  <span class=s2>&quot;</span><span class=se>\t</span><span class=s2>- from the function call: </span><span class=si>{2}</span><span class=s2> </span><span class=si>{3}</span><span class=se>\n</span><span class=s2>&quot;</span>
                  <span class=s2>&quot;Then I can pass them to the decorated function&quot;</span>
                  <span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>decorator_arg1</span><span class=p>,</span> <span class=n>decorator_arg2</span><span class=p>,</span>
                          <span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>))</span>
            <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>wrapped</span>

    <span class=k>return</span> <span class=n>my_decorator</span>


<span class=nd>@decorator_maker_with_arguments</span><span class=p>(</span><span class=s2>&quot;foo&quot;</span><span class=p>,</span> <span class=s2>&quot;bar&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>decorated_function_with_arguments</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;I am the decorated function with arguments&quot;</span><span class=p>,</span>
          <span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>)</span>

<span class=n>decorated_function_with_arguments</span><span class=p>(</span><span class=s2>&quot;wife&quot;</span><span class=p>,</span> <span class=s2>&quot;husband&quot;</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># I make decorators! And I accept arguments: foo bar</span>
<span class=c1># I am the decorator.  You passed me arguments: foo bar</span>
<span class=c1># I am the wrapper around the decorated function.</span>
<span class=c1># I can access all the variables</span>
<span class=c1>#   - from the decorator: foo bar</span>
<span class=c1>#   - from the function call: wife husband</span>
<span class=c1># Then I can pass them to the decorated function</span>
<span class=c1># I am the decorated function with arguments wife husband</span>
</pre></div> <p>Việc truyền tham số vào các hàm lồng nhau như vậy có sự giúp đỡ của closure. Bạn có thể tìm hiểu thêm về closure ở <a href=http://mrevelle.blogspot.com/2006/10/closure-on-closures.html>bài viết này</a></p> <p>Vậy là chúng ta đã có một hàm, và chúng ta có thể truyền tham số cho hàm đó và sử dụng nó làm decorator. Thậm chí chúng ta có thể dùng biến để truyền tham số.</p> <div class=codehilite><pre><span></span><span class=n>var1</span> <span class=o>=</span> <span class=s2>&quot;foo&quot;</span>
<span class=n>var2</span> <span class=o>=</span> <span class=s2>&quot;bar&quot;</span>

<span class=nd>@decorator_maker_with_arguments</span><span class=p>(</span><span class=n>var1</span><span class=p>,</span> <span class=n>var2</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>decorated_function_with_arguments</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>):</span>
    <span class=nb>print</span> <span class=p>(</span><span class=s2>&quot;I am the decorated function with arguments:&quot;</span>
           <span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>)</span>

<span class=n>var3</span> <span class=o>=</span> <span class=s2>&quot;wife&quot;</span>
<span class=n>var4</span> <span class=o>=</span> <span class=s2>&quot;husband&quot;</span>
<span class=n>decorated_function_with_arguments</span><span class=p>(</span><span class=n>var3</span><span class=p>,</span> <span class=n>var4</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># I make decorators! And I accept arguments: foo bar</span>
<span class=c1># I am the decorator.  You passed me arguments: foo bar</span>
<span class=c1># I am the wrapper around the decorated function.</span>
<span class=c1># I can access all the variables</span>
<span class=c1>#   - from the decorator: foo bar</span>
<span class=c1>#   - from the function call: wife husband</span>
<span class=c1># Then I can pass them to the decorated function</span>
<span class=c1># I am the decorated function with arguments wife husband</span>
</pre></div> <p>Với cách làm như trên, bạn có thể xây dựng decorator nhận tham số như những hàm thông thường khác. Bạn cũng có thể sử dụng <code>*args</code> và <code>**kwargs</code> nếu muốn. Tuy nhiên, cần lưu ý rằng, decorator chỉ được gọi <strong>duy nhất một lần</strong>. Khi một hàm đã được decorate rồi, bạn không thể thay đổi nó nữa. Bạn cũng không thể truyền tham số động được.</p> <h2 id=decorate-mot-decorator>Decorate một decorator<a class=headerlink href=#decorate-mot-decorator title="Permanent link">&para;</a></h2> <p>Trong phần trước, tôi đã trình bày cách xây dựng một decorator nhận tham số đầu vào. Biện pháp là sử dụng thêm một hàm lồng nhau nữa. Tức là chúng ta đã bao bọc decorator bằng một hàm khác. Nghe quen thế nhỉ? Chính xác, đây chính là cách xây dựng một decorator.</p> <p>Đây là một trick khá thú vị, decorate một decorator. Bởi vì decorator cũng là hàm nên nó hoàn toàn có thể được decorate bởi những decorator khác.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator_with_args</span><span class=p>(</span><span class=n>decorator_to_enhance</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Hàm này sẽ được dùng làm decorator.  Nó sẽ decorate một hàm mà</span>
<span class=sd>    hàm đó cũng sẽ trở thành decorator.  Decorator này cho phép</span>
<span class=sd>    bạn xây dựng decorator có thể nhận bất kỳ tham số nào, mà</span>
<span class=sd>    không cần nhớ cách thực hiện chúng.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># We use the same trick we did to pass arguments</span>
    <span class=k>def</span> <span class=nf>decorator_maker</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>

        <span class=c1># Chúng ta tạo ra một decorator nhận đầu vào là một hàm,</span>
        <span class=c1># nhưng có thể truyền tham số từ maker.</span>
        <span class=k>def</span> <span class=nf>decorator_wrapper</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>

            <span class=c1># Chúng ta return kết quả của decorator gốc, thực ra</span>
            <span class=c1># nó cũng là hàm THÔNG THƯỜNG (nhưng return một hàm</span>
            <span class=c1># khác).  Lưu ý rằng, decorator phải sử dụng đúng</span>
            <span class=c1># nguyên mẫu mới có thể chạy được.</span>
            <span class=k>return</span> <span class=n>decorator_to_enhance</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>decorator_wrapper</span>

    <span class=k>return</span> <span class=n>decorator_maker</span>
</pre></div> <p>Chúng ta có thể sử dụng nó như sau:</p> <div class=codehilite><pre><span></span><span class=c1># Chúng ta sẽ tạo ra một hàm dùng làm decorator.  Và dùng</span>
<span class=c1># decorator đã tạo ra ở trên cho hàm này.  Nguyên mẫu hàm phải là</span>
<span class=c1># decorator(func, *args, **kwargs) thì mới hoạt động được.</span>
<span class=nd>@decorator_with_args</span>
<span class=k>def</span> <span class=nf>decorated_decorator</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Decorated with&quot;</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=c1># Sau đó chúng ta có thể dùng decorator này với các hàm chúng a</span>
<span class=c1># muốn và có thể truyền tham số tùy ý.</span>

<span class=nd>@decorated_decorator</span><span class=p>(</span><span class=mi>42</span><span class=p>,</span> <span class=mi>404</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>decorated_function</span><span class=p>(</span><span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Hello&quot;</span><span class=p>,</span> <span class=n>function_arg1</span><span class=p>,</span> <span class=n>function_arg2</span><span class=p>)</span>

<span class=n>decorated_function</span><span class=p>(</span><span class=s2>&quot;Universe and&quot;</span><span class=p>,</span> <span class=s2>&quot;everything&quot;</span><span class=p>)</span>
<span class=c1># output:</span>
<span class=c1># Decorated with (42, 404, 1024) {}</span>
<span class=c1># Hello Universe and everything</span>
</pre></div> <h2 id=luu-y>Lưu ý<a class=headerlink href=#luu-y title="Permanent link">&para;</a></h2> <ul> <li>Decorator được giới thiệu từ phiên bản Python 2.4 nên bạn cần sử dụng Python đúng phiên bản mới có thể dùng được.</li> <li>Mặc dù cú pháp đơn giản, nhưng decorator không làm hàm nhanh hơn, thậm chí nó còn làm hàm chậm đi.</li> <li>Bạn không thể bỏ decorator cho một hàm. Một khi hàm đã được decorate rồi, thì nó sẽ được decorate mãi mãi.</li> <li>Vì decorator bao bọc các hàm nên rất khó để debug. Tuy nhiên, đã có giải pháp nếu bạn sử dụng Python 2.5 trở nên.</li> </ul> <p>Từ phiên bản 2.5 trở nên, Python có module <code>functools</code> trong đó có hàm <code>functools.wraps</code> giúp chúng ta copy tên, module, docstring, v.v. của hàm được decorate vào hàm wrapper của chúng ta.</p> <div class=codehilite><pre><span></span><span class=c1># Để debug, chúng a in ra tên của hàm</span>
<span class=k>def</span> <span class=nf>foo</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;foo&quot;</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>foo</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span> <span class=c1># output: foo</span>

<span class=c1># Nếu dùng decorator, mọi thứ khác đi nhiều.</span>
<span class=k>def</span> <span class=nf>bar</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;bar&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>func</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=nd>@bar</span>
<span class=k>def</span> <span class=nf>foo</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;foo&quot;</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>foo</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span> <span class=c1># output: wrapper</span>

<span class=c1># &quot;functools&quot; có thể giúp chúng ta</span>

<span class=kn>import</span> <span class=nn>functools</span>

<span class=k>def</span> <span class=nf>bar</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=c1># Đây là wrapper bao bọc hàm được decorator.  Tuy nhiên, sự kỳ</span>
    <span class=c1># diệu ở đây là nhờ functools.</span>
    <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>():</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;bar&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>func</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>wrapper</span>

<span class=nd>@bar</span>
<span class=k>def</span> <span class=nf>foo</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;foo&quot;</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>foo</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span> <span class=c1># output: foo</span>
</pre></div> <h2 id=decorator-co-thuc-su-can-thiet-hay-khong>Decorator có thực sự cần thiết hay không?<a class=headerlink href=#decorator-co-thuc-su-can-thiet-hay-khong title="Permanent link">&para;</a></h2> <p>Tất nhiên là cần thiết thì người ta mới có cú pháp cho decorator. Tuy nhiên, câu hỏi đặt ra là khi nào thì sử dụng decorator.</p> <p>Decorator có thể được sử dụng để debug mà không cần thay đổi hàm hay thư viện. Ví dụ chúng ta có thể dùng decorator để debug và đánh giá hiệu năng các tính năng mà không cần thay đổi code của chúng.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>benchmark</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Decorator in ra thời gian thực thi hàm</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>import</span> <span class=nn>time</span>

    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=n>t</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>clock</span><span class=p>()</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>clock</span><span class=p>()</span> <span class=o>-</span> <span class=n>t</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>res</span>
    <span class=k>return</span> <span class=n>wrapper</span>


<span class=k>def</span> <span class=nf>logging</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Decorator ghi log về hoạt động của code. Ở đây chỉ đơn giản</span>
<span class=sd>    là in ra tên hàm nào đang được gọi.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>res</span>
    <span class=k>return</span> <span class=n>wrapper</span>


<span class=k>def</span> <span class=nf>counter</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Decorator đếm và in ra số lần hàm được gọi trong chương</span>
<span class=sd>    trình.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=n>wrapper</span><span class=o>.</span><span class=n>count</span> <span class=o>=</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>count</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=n>res</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{0}</span><span class=s2> has been used: </span><span class=si>{1}</span><span class=s2>x&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>func</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>count</span><span class=p>))</span>
        <span class=k>return</span> <span class=n>res</span>
    <span class=n>wrapper</span><span class=o>.</span><span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>return</span> <span class=n>wrapper</span>


<span class=nd>@counter</span>
<span class=nd>@benchmark</span>
<span class=nd>@logging</span>
<span class=k>def</span> <span class=nf>reverse_string</span><span class=p>(</span><span class=n>string</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>string</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

<span class=nb>print</span><span class=p>(</span><span class=n>reverse_string</span><span class=p>(</span><span class=s2>&quot;Able was I ere I saw Elba&quot;</span><span class=p>))</span>
<span class=nb>print</span><span class=p>(</span><span class=n>reverse_string</span><span class=p>(</span><span class=s2>&quot;Lorem ipsum dolor sit amet, et cetero complectitur &quot;</span>
                     <span class=s2>&quot;mel, sea mundi delectus gubergren et.  In pro postea &quot;</span>
                     <span class=s2>&quot;ullamcorper, per dissentias vituperatoribus et.  Sed &quot;</span>
                     <span class=s2>&quot;saepe quaeque voluptaria et, et quod dolores &quot;</span>
                     <span class=s2>&quot;voluptaria vel.  An cum causae mediocritatem &quot;</span>
                     <span class=s2>&quot;vituperatoribus.  Est an nobis adversarium.  Probo &quot;</span>
                     <span class=s2>&quot;scripta omnesque ne sed, delicata volutpat no per.&quot;</span><span class=p>))</span>

<span class=c1># output:</span>
<span class=c1># reverse_string (&#39;Able was I ere I saw Elba&#39;,) {}</span>
<span class=c1># wrapper 2.6999999999999247e-05</span>
<span class=c1># wrapper has been used: 1x</span>
<span class=c1># ablE was I ere I saw elbA</span>
<span class=c1># reverse_string (&#39;Lorem ipsum dolor sit amet, et cetero complectitur mel, sea mundi delectus gubergren et.  In pro postea ullamcorper, per dissentias vituperatoribus et.  Sed saepe quaeque voluptaria et, et quod dolores voluptaria vel.  An cum causae mediocritatem vituperatoribus.  Est an nobis adversarium.  Probo scripta omnesque ne sed, delicata volutpat no per.&#39;,) {}</span>
<span class=c1># wrapper 1.2999999999999123e-05</span>
<span class=c1># wrapper has been used: 2x</span>
<span class=c1># .rep on taptulov ataciled ,des en euqsenmo atpircs oborP .muirasrevda sibon na tsE .subirotareputiv metatircoidem easuac muc nA .lev airatpulov serolod douq te ,te airatpulov euqeauq epeas deS .te subirotareputiv saitnessid rep ,reprocmallu aetsop orp nI .te nergrebug sutceled idnum aes ,lem rutitcelpmoc oretec te ,tema tis rolod muspi meroL</span>
</pre></div> <p>Điều tuyệt vời của decorator là bạn có thể dùng nó với bất cứ thứ gì mà không cần thay đổi nội dung.</p> <div class=codehilite><pre><span></span><span class=nd>@counter</span>
<span class=nd>@benchmark</span>
<span class=nd>@logging</span>
<span class=k>def</span> <span class=nf>get_an_excuse</span><span class=p>():</span>
    <span class=kn>import</span> <span class=nn>urllib.request</span>
    <span class=kn>import</span> <span class=nn>re</span>
    <span class=n>handle</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=s2>&quot;http://programmingexcuses.com/&quot;</span><span class=p>)</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>handle</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>.+&gt;([,&#39;.?!\w\s]+)&lt;/a&gt;&quot;</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>get_an_excuse</span><span class=p>())</span>
<span class=nb>print</span><span class=p>(</span><span class=n>get_an_excuse</span><span class=p>())</span>
<span class=c1># output:</span>
<span class=c1># get_an_excuse () {}</span>
<span class=c1># wrapper 0.07300399999999999</span>
<span class=c1># wrapper has been used: 1x</span>
<span class=c1># Our internet connection must not be working</span>
<span class=c1># get_an_excuse () {}</span>
<span class=c1># wrapper 0.0027760000000000007</span>
<span class=c1># wrapper has been used: 2x</span>
<span class=c1># That process requires human oversight that nobody was providing</span>
</pre></div> <p>Python bản thân nó cũng có sẵn rất nhiều decorator như <code>@property</code>, <code>@classmethod</code>, v.v... Django cũng thường xuyên sử dụng decorator, nhất là khi phân quyền cho người dùng.</p> <p>Decorator là một công cụ rất mạnh mẽ, nên nếu sử dụng đúng, nó sẽ cho chúng ta những tiện ích tuyệt vời.</p> <h2 id=bonus-decorator-ma-van-giu-uoc-ham-goc>Bonus: Decorator mà vẫn giữ được hàm gốc<a class=headerlink href=#bonus-decorator-ma-van-giu-uoc-ham-goc title="Permanent link">&para;</a></h2> <p>Như phần trước tôi đã nói, một hàm khi đã được decorate rồi thì chúng ta không thể bỏ decorator đi được. Bất cứ khi nào bạn gọi hàm, thực ra bạn đang gọi hàm đã được decorate.</p> <p>Nhưng nhiều trường hợp, bạn chỉ muốn thực thi hàm gốc thôi. Vậy phải làm thế nào? Không lẽ phải định nghĩa lại hàm.</p> <p>Thực ra có một trick để làm việc này. Nói chung nó rất dễ hiểu nên chắc chỉ cần nhìn code là hiểu ngay.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>decorator_keep_original_function</span><span class=p>(</span><span class=n>function_to_decorate</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is decorated function&quot;</span><span class=p>)</span>
        <span class=n>function_to_decorate</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=c1># Chúng ta sẽ lưu hàm gốc chưa được decorate như là một</span>
    <span class=c1># thuộc tính của hàm mới.</span>
    <span class=n>wrapper</span><span class=o>.</span><span class=n>_original_function</span> <span class=o>=</span> <span class=n>function_to_decorate</span>
    <span class=k>return</span> <span class=n>wrapper</span>


<span class=nd>@decorator_keep_original_function</span>
<span class=k>def</span> <span class=nf>some_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is original function&quot;</span><span class=p>)</span>

<span class=c1># Gọi hàm đã được decorate</span>
<span class=n>some_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># This is decorated function</span>
<span class=c1># This is original function</span>

<span class=c1># Chúng ta vẫn có thể gọi hàm gốc chứa decorate</span>
<span class=n>some_function</span><span class=o>.</span><span class=n>_original_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># This is original function</span>
</pre></div> <p>Có một cách khác, đó là sử dụng <code>__closure__</code> để lấy lại nội dung của hàm gốc. Cách này chỉ hoạt động nếu chúng ta có sử dụng closure. Lưu ý rằng, không phải tất cả các hàm lồng nhau đều là closure.</p> <div class=codehilite><pre><span></span><span class=k>def</span> <span class=nf>undecorator</span><span class=p>(</span><span class=n>decorated_function</span><span class=p>):</span>
    <span class=c1># Python &lt; 2.6 sử dụng `func_closure` thay thế cho</span>
    <span class=c1># `__closure__`</span>
    <span class=k>return</span> <span class=n>decorated_function</span><span class=o>.</span><span class=vm>__closure__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>cell_contents</span>


<span class=k>def</span> <span class=nf>decorator_to_undo</span><span class=p>(</span><span class=n>function_to_decorate</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is decorated function&quot;</span><span class=p>)</span>
        <span class=n>function_to_decorate</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>wrapper</span>


<span class=nd>@decorator_to_undo</span>
<span class=k>def</span> <span class=nf>some_function</span><span class=p>():</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is original function&quot;</span><span class=p>)</span>

<span class=c1># Hàm đã được decorate</span>
<span class=n>some_function</span><span class=p>()</span>
<span class=c1># output:</span>
<span class=c1># This is decorated function</span>
<span class=c1># This is original function</span>

<span class=c1># Thử undecorate xem sao</span>
<span class=n>undecorator</span><span class=p>(</span><span class=n>some_function</span><span class=p>)()</span>
<span class=c1># output:</span>
<span class=c1># This is original function</span>
<span class=c1># =&gt; Đây chính là điều chúng ta mong đợi.</span>
</pre></div> <h1 id=ket-luan>Kết luận<a class=headerlink href=#ket-luan title="Permanent link">&para;</a></h1> <p>Trên đây là những hiểu biết của tôi về decorator được dùng trong Python. Decorator là một công cụ rất hữu dụng và được sử dụng khá thường xuyên. Hy vọng bài viết cho bạn phần nào hiểu biết về decorator, cách viết và sử dụng chúng.</p> </div> <div class=post-footer> <div class=tags> <i class="fa fa-tags"></i> <span>#Python</span> <span>#decorator</span> <span>#fundamental</span> </div> </div> </div><div class=blog-pager> <span class=newer-link> <a href=/2015/Dec/31/the-year-in-review-2015.html> Newer Post </a> </span> <span class=older-link> <a href=/2015/Dec/20/the-editor-war-the-oldest-rivalry-in-computing.html> Older Post </a> </span> </div><div class=comments> <div class=finally> <p><em>I apologise for any typos. If you notice a problem, please let me know.</em> <p>Thank you all for your attention. </div> <div id=disqus_thread></div> <script src=/theme/js/disqus.min.js?81e8a5f5></script> <noscript> Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript> comments powered by Disqus. </a> </noscript> </div></div> </div> </div> <div class=sidebar-wrapper> <div class=widget> <h2>Welcome</h2> <div> <img src=/theme/images/banner.gif alt=Welcome> </div> </div><div class="widget recent-posts"> <h2>Recent Posts</h2> <ul> <li> <a href=/2019/May/20/elasticsearch-data-organization.html> <img alt="Elasticsearch: Data organization" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-data-organization.html>Elasticsearch: Data organization</a> <li> <a href=/2019/May/20/elasticsearch-intro.html> <img alt="Elasticsearch: Intro" src=https://i.imgur.com/JT4y7Qf.jpg> </a> <a href=/2019/May/20/elasticsearch-intro.html>Elasticsearch: Intro</a> <li> <a href=/2019/Apr/20/javascript-popups.html> <img alt="JavaScript: Popups" src=https://i.imgur.com/FxmcwPy.png> </a> <a href=/2019/Apr/20/javascript-popups.html>JavaScript: Popups</a> <li> <a href=/2019/Mar/20/javascript-iterator-and-generator.html> <img alt="JavaScript: Iterator and generator" src=https://i.imgur.com/lev8iT9.jpg> </a> <a href=/2019/Mar/20/javascript-iterator-and-generator.html>JavaScript: Iterator and generator</a> <li> <a href=/2019/Feb/20/javascript-decorator.html> <img alt="JavaScript decorator" src=https://i.imgur.com/Sh3yLI0.png> </a> <a href=/2019/Feb/20/javascript-decorator.html>JavaScript decorator</a> </ul> </div><div class="widget labels"> <h2>Blog Archive</h2> <ul> <li> <a href=/2019/ > 2019 </a> <li> <a href=/2018/ > 2018 </a> <li> <a href=/2017/ > 2017 </a> <li> <a href=/2016/ > 2016 </a> <li> <a href=/2015/ > 2015 </a> <li> <a href=/2014/ > 2014 </a> <li> <a href=/2013/ > 2013 </a> <li> <a href=/2012/ > 2012 </a> <li> <a href=/2011/ > 2011 </a> <li> <a href=/2010/ > 2010 </a> </ul> </div><div class=widget> <h2>Twitter timeline</h2> <a class=twitter-timeline data-height=500 data-dnt=true data-theme=light href=https://twitter.com/_naa_4f data-chrome="noheader nofooter transparent noborders"> Tweets by manhhomienbienthuy </a> </div> </div> </div> <a href=# class="smooth-scroll back-to-top"> <i class="fa fa-arrow-circle-up fa-3x"></i> </a> </main> <footer> <div class=infos> <div class=wrapper> <div class=widget> <a href=/ title="manhhomienbienthuy's space" class=logo> <img alt="manhhomienbienthuy's space" src=/theme/images/logo_white.png> </a> <span class=right>I'm a hacker, enter my world...</span> </div><div class=widget> <p> Created with all my ♥ and soul, dedicated to my love, yunachan <p> Powered by <a href=http://blog.getpelican.com/ target=_blank>Pelican</a>, which takes great advantage of <a href=https://www.python.org/ target=_blank>Python</a> <p> This site content is licensed under a <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank> CC BY-NC-ND 4.0 </a> License. <p> Updated at <a target=_blank href="http://www.timeanddate.com/worldclock/fixedtime.html?iso=2019-06-20T02:42:55"> 2019-06-20 02:42:55 </a> </div><div class=widget> <p> Hosting by <a href=https://manhhomienbienthuy.bitbucket.io/ >Bitbucket</a> and <a href=https://manhhomienbienthuy.github.io/ >Github</a>, image hosting by <a href=https://manhhomienbienthuy.imgur.com/ target=_blank>imgur</a>, <a href=https://instagram.com/manhhomienbienthuy/ target=_blank>Instagram</a> and <a href=https://photos.google.com/ target=_blank>Google Photo</a> <p> Theme based on <a href=https://vanice-veethemes.blogspot.com/ target=_blank>Vanice theme</a>, icons from <a href=https://fontawesome.com/ target=_blank>Font Awesome</a>, comments powered by <a href=https://disqus.com/home/forums/manhhomienbienthuy/ target=_blank>Disqus</a> </div> </div> </div> <div class=credits> <div class=wrapper> <div class=left> <!--
          Regarding copyright, in general, standalone pages (as
          opposed to files generated as part of manuals) on the GNU
          web server should be under CC BY-ND 4.0.  Please do NOT
          change or remove this without talking with the webmasters or
          licensing team first.  Please make sure the copyright date
          is consistent with the document.  For web pages, it is ok to
          list just the latest year the document was modified, or
          published.

          If you wish to list earlier years, that is ok too.  Either
          "2001, 2002, 2003" or "2001-2003" are ok for specifying
          years, as long as each year in the range is in fact a
          copyrightable year, i.e., a year in which the document was
          published (including being publicly visible on the web or in
          a revision control system).
        --> Copyright © 2010-2019 <a href=/pages/about-me.html><strong>manhhomienbienthuy</strong></a>. All rights reserved. </div> <div class=right> <ul> <li><a href=/ >Home</a> <li><a href=/pages/about-me.html>About</a> <li><a href=# class=smooth-scroll>Top ↑</a> </ul> </div> </div> </div></footer> <script src=https://code.jquery.com/jquery-3.2.1.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js></script> <script src=/theme/js/vpyeu.min.js?d72c87bd></script> <script id=dsq-count-scr src=https://manhhomienbienthuy.disqus.com/count.js async></script>